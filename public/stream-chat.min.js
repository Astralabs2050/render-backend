/**
 * Minified by jsDelivr using Terser v5.39.0.
 * Original file: /npm/stream-chat@8.40.8/dist/browser.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var base64Js=require("base64-js"),_extends=require("@babel/runtime/helpers/extends"),_typeof=require("@babel/runtime/helpers/typeof"),_objectWithoutProperties=require("@babel/runtime/helpers/objectWithoutProperties"),_toConsumableArray=require("@babel/runtime/helpers/toConsumableArray"),_asyncToGenerator=require("@babel/runtime/helpers/asyncToGenerator"),_classCallCheck=require("@babel/runtime/helpers/classCallCheck"),_createClass=require("@babel/runtime/helpers/createClass"),_defineProperty=require("@babel/runtime/helpers/defineProperty"),_regeneratorRuntime=require("@babel/runtime/regenerator"),axios=require("axios"),_slicedToArray=require("@babel/runtime/helpers/slicedToArray"),FormData=require("form-data"),WebSocket=require("isomorphic-ws"),_assertThisInitialized=require("@babel/runtime/helpers/assertThisInitialized"),_inherits=require("@babel/runtime/helpers/inherits"),_possibleConstructorReturn=require("@babel/runtime/helpers/possibleConstructorReturn"),_getPrototypeOf=require("@babel/runtime/helpers/getPrototypeOf"),_wrapNativeSuper=require("@babel/runtime/helpers/wrapNativeSuper");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _extends__default=_interopDefaultLegacy(_extends),_typeof__default=_interopDefaultLegacy(_typeof),_objectWithoutProperties__default=_interopDefaultLegacy(_objectWithoutProperties),_toConsumableArray__default=_interopDefaultLegacy(_toConsumableArray),_asyncToGenerator__default=_interopDefaultLegacy(_asyncToGenerator),_classCallCheck__default=_interopDefaultLegacy(_classCallCheck),_createClass__default=_interopDefaultLegacy(_createClass),_defineProperty__default=_interopDefaultLegacy(_defineProperty),_regeneratorRuntime__default=_interopDefaultLegacy(_regeneratorRuntime),axios__default=_interopDefaultLegacy(axios),_slicedToArray__default=_interopDefaultLegacy(_slicedToArray),FormData__default=_interopDefaultLegacy(FormData),WebSocket__default=_interopDefaultLegacy(WebSocket),_assertThisInitialized__default=_interopDefaultLegacy(_assertThisInitialized),_inherits__default=_interopDefaultLegacy(_inherits),_possibleConstructorReturn__default=_interopDefaultLegacy(_possibleConstructorReturn),_getPrototypeOf__default=_interopDefaultLegacy(_getPrototypeOf),_wrapNativeSuper__default=_interopDefaultLegacy(_wrapNativeSuper);function isString$1(e){return"string"==typeof e}function isMapStringCallback(e,t){return!!t&&isString$1(e)}function map(e,t){var n=[];if(isString$1(e)&&isMapStringCallback(e,t)){for(var r=0,a=e.length;r<a;r++)if(e.charAt(r)){var s=t(e.charAt(r),r,e);n[r]=s}}else if(!isString$1(e)&&!isMapStringCallback(e,t))for(var i=0,o=e.length;i<o;i++)if(i in e){var u=t(e[i],i,e);n[i]=u}return n}var encodeBase64=function(e){return base64Js.fromByteArray(new Uint8Array(map(e,(function(e){return e.charCodeAt(0)}))))},decodeBase64=function(e){var t,n,r,a={},s=String.fromCharCode,i=e.length,o=0,u=0,l="";for(t=0;t<64;t++)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t)]=t;for(n=0;n<i;n++)for(o=(o<<6)+a[e.charAt(n)],u+=6;u>=8;)((r=o>>>(u-=8)&255)||n<i-2)&&(l+=s(r));return l},https=null;function ownKeys$b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$b(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _createForOfIteratorHelper$4(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$4(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){throw e})),f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){o=!0,s=e})),f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function _unsupportedIterableToArray$4(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$4(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$4(e,t):void 0}}function _arrayLikeToArray$4(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function logChatPromiseExecution(e,t){e.then().catch((function(e){console.warn("failed to do ".concat(t,", ran into error: "),e)}))}var sleep=function(e){return new Promise((function(t){return setTimeout(t,e)}))};function isFunction(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}var chatCodes={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3};function isReadableStream(e){return null!==e&&"object"===_typeof__default.default(e)&&(e.readable||"function"==typeof e._read)}function isBuffer(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function isFileWebAPI(e){return"undefined"!=typeof window&&"File"in window&&e instanceof File}function isOwnUser(e){return void 0!==(null==e?void 0:e.total_unread_count)}function isBlobWebAPI(e){return"undefined"!=typeof window&&"Blob"in window&&e instanceof Blob}function isOwnUserBaseProperty(e){return{channel_mutes:!0,devices:!0,mutes:!0,total_unread_count:!0,unread_channels:!0,unread_count:!0,unread_threads:!0,invisible:!0,privacy_settings:!0,roles:!0}[e]}function addFileToFormData(e,t,n){var r=new FormData__default.default;return isReadableStream(e)||isBuffer(e)||isFileWebAPI(e)||isBlobWebAPI(e)?t?r.append("file",e,t):r.append("file",e):r.append("file",{uri:e,name:t||e.split("/").reverse()[0],contentType:n||void 0,type:n||void 0}),r}function normalizeQuerySort(e){var t,n=[],r=_createForOfIteratorHelper$4(Array.isArray(e)?e:[e]);try{for(r.s();!(t=r.n()).done;){var a=t.value,s=Object.entries(a);s.length>1&&console.warn("client._buildSort() - multiple fields in a single sort object detected. Object's field order is not guaranteed");for(var i=0,o=s;i<o.length;i++){var u=_slicedToArray__default.default(o[i],2),l=u[0],c=u[1];n.push({field:l,direction:c})}}}catch(e){r.e(e)}finally{r.f()}return n}function retryInterval(e){var t=Math.min(500+2e3*e,25e3),n=Math.min(Math.max(250,2e3*(e-1)),25e3);return Math.floor(Math.random()*(t-n)+n)}function randomId(){return generateUUIDv4()}function hex(e){for(var t="",n=0;n<e.length;n++)t+=e[n].toString(16).padStart(2,"0");return t}function generateUUIDv4(){var e=getRandomBytes(16);return e[6]=15&e[6]|64,e[8]=191&e[8]|128,hex(e.subarray(0,4))+"-"+hex(e.subarray(4,6))+"-"+hex(e.subarray(6,8))+"-"+hex(e.subarray(8,10))+"-"+hex(e.subarray(10,16))}function getRandomValuesWithMathRandom(e){for(var t=Math.pow(2,8*e.byteLength/e.length),n=0;n<e.length;n++)e[n]=Math.random()*t}var getRandomValues=function(){var e;return"undefined"!=typeof crypto&&void 0!==(null===(e=crypto)||void 0===e?void 0:e.getRandomValues)?crypto.getRandomValues.bind(crypto):"undefined"!=typeof msCrypto?msCrypto.getRandomValues.bind(msCrypto):getRandomValuesWithMathRandom}();function getRandomBytes(e){var t=new Uint8Array(e);return getRandomValues(t),t}function convertErrorToJson(e){var t={};if(!e)return t;try{Object.getOwnPropertyNames(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)}))}catch(e){return{error:"failed to serialize the error"}}return t}function isOnline(){var e="undefined"!=typeof navigator?navigator:"undefined"!=typeof window&&window.navigator?window.navigator:void 0;return e?"boolean"!=typeof e.onLine||e.onLine:(console.warn("isOnline failed to access window.navigator and assume browser is online"),!0)}function addConnectionEventListeners(e){"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("offline",e),window.addEventListener("online",e))}function removeConnectionEventListeners(e){"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("offline",e),window.removeEventListener("online",e))}var axiosParamsSerializer=function(e){var t=[];for(var n in e)void 0!==e[n]&&(Array.isArray(e[n])||"object"===_typeof__default.default(e[n])?t.push("".concat(n,"=").concat(encodeURIComponent(JSON.stringify(e[n])))):t.push("".concat(n,"=").concat(encodeURIComponent(e[n]))));return t.join("&")};function formatMessage(e){return _objectSpread$b(_objectSpread$b({},e),{},{__html:e.html,pinned_at:e.pinned_at?new Date(e.pinned_at):null,created_at:e.created_at?new Date(e.created_at):new Date,updated_at:e.updated_at?new Date(e.updated_at):new Date,deleted_at:e.deleted_at?new Date(e.deleted_at):null,status:e.status||"received",reaction_groups:maybeGetReactionGroupsFallback(e.reaction_groups,e.reaction_counts,e.reaction_scores)})}var findIndexInSortedArray=function(e){var t=e.needle,n=e.sortedArray,r=e.selectValueToCompare,a=void 0===r?function(e){return e}:r,s=e.sortDirection,i=void 0===s?"ascending":s;if(!n.length)return 0;var o=0,u=n.length-1,l=0,c=function(){l=Math.round((o+u)/2)},d=a(t);for(c();o<=u;)"ascending"===i&&d<a(n[l])||"descending"===i&&d>a(n[l])?u=l-1:o=l+1,c();return o};function addToMessageList(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4]||n,s=_toConsumableArray__default.default(e);if(n&&(s=s.filter((function(e){return!(e.id&&t.id===e.id)}))),0===s.length&&a)return s.concat(t);if(0===s.length)return s;var i=t[r].getTime(),o=s.at(-1)[r].getTime()<i;if(o&&a)return s.concat(t);if(o)return s;var u=findIndexInSortedArray({needle:t,sortedArray:e,sortDirection:"ascending",selectValueToCompare:function(e){return e[r].getTime()}});if(!n&&t.id){if(s[u]&&t.id===s[u].id)return s[u]=t,s;if(s[u-1]&&t.id===s[u-1].id)return s[u-1]=t,s}return a&&s.splice(u,0,t),s}function maybeGetReactionGroupsFallback(e,t,n){if(e)return e;if(t&&n){for(var r={},a=0,s=Object.keys(t);a<s.length;a++){var i=s[a];r[i]={count:t[i],sum_scores:n[i]}}return r}return null}var throttle=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.leading,a=void 0===r||r,s=n.trailing,i=void 0!==s&&s,o=null,u=null;return function(){for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];if(o)i&&(u=r);else{a&&e.apply(void 0,r);o=setTimeout((function n(){if(u)return e.apply(void 0,_toConsumableArray__default.default(u)),u=null,void(o=setTimeout(n,t));o=null}),t)}}};function binarySearchByDateEqualOrNearestGreater(e,t){for(var n=0,r=e.length-1;n<=r;){var a=Math.floor((n+r)/2),s=e[a].created_at;if(s){var i=new Date(s);if(i.getTime()===t.getTime())return a;i.getTime()<t.getTime()?n=a+1:r=a-1}else n+=1}return n}var messagePaginationCreatedAtAround=function(e){var t,n,r,a,s=e.parentSet,i=e.requestedPageSize,o=e.returnedPage,u=e.messagePaginationOptions,l=_objectSpread$b({},s.pagination);if(null==u||!u.created_at_around)return l;var c=new Date(u.created_at_around),d=[o[0],o.slice(-1)[0]],f=d[0],_=d[1],p=!(null==f||!f.created_at)&&new Date(f.created_at)>c,h=!(null==_||!_.created_at)&&new Date(_.created_at)<c,g=i>s.messages.length&&i>o.length,v=(i>s.messages.length||s.messages.length>=o.length)&&i>o.length;if(p)t=!1,r=!0,g&&(n=!1,a=!0);else if(h)n=!1,a=!0,g&&(t=!1,r=!0);else if(v)n=t=!1,r=a=!0;else{var m,y;r=(null==f?void 0:f.id)&&f.id===(null===(m=s.messages[0])||void 0===m?void 0:m.id),a=(null==_?void 0:_.id)&&_.id===(null===(y=s.messages.slice(-1)[0])||void 0===y?void 0:y.id);var b=Math.floor(o.length/2),w=binarySearchByDateEqualOrNearestGreater(o,c);-1!==w&&(t=b<=w,n=b>=w)}return r&&void 0!==t&&(l.hasPrev=t),a&&void 0!==n&&(l.hasNext=n),l},messagePaginationIdAround=function(e){var t,n,r,a,s=e.parentSet,i=e.requestedPageSize,o=e.returnedPage,u=e.messagePaginationOptions,l=_objectSpread$b({},s.pagination),c=(u||{}).id_around;if(!c)return l;var d=[o[0],o.slice(-1)[0]],f=d[0],_=d[1],p=(null==f?void 0:f.id)===(null===(t=s.messages[0])||void 0===t?void 0:t.id),h=(null==_?void 0:_.id)===(null===(n=s.messages.slice(-1)[0])||void 0===n?void 0:n.id),g=Math.floor(o.length/2);if((i>s.messages.length||s.messages.length>=o.length)&&i>o.length)a=r=!1,p=h=!0;else{if(!o[g])return l;if(o[g].id===c)r=a=!0;else{var v,m=[o.slice(0,g),o.slice(g)];r=a=!0;for(var y=0;y<m.length;y++)(v=m[y].find((function(e){return e.id===c})))&&0===y&&(r=!1),v&&1===y&&(a=!1)}}return p&&void 0!==r&&(l.hasPrev=r),h&&void 0!==a&&(l.hasNext=a),l},messagePaginationLinear=function(e){var t,n,r,a,s=e.parentSet,i=e.requestedPageSize,o=e.returnedPage,u=e.messagePaginationOptions,l=_objectSpread$b({},s.pagination),c=[o[0],o.slice(-1)[0]],d=c[0],f=c[1],_=(null==d?void 0:d.id)&&d.id===(null===(t=s.messages[0])||void 0===t?void 0:t.id),p=(null==f?void 0:f.id)&&f.id===(null===(n=s.messages.slice(-1)[0])||void 0===n?void 0:n.id),h=u&&(u.created_at_after_or_equal||u.created_at_after||u.id_gt||u.id_gte),g=void 0===u||(u.created_at_before_or_equal||u.created_at_before||u.id_lt||u.id_lte||u.offset),v=!(h||g||null!=u&&u.id_around||null!=u&&u.created_at_around),m=o.length>=i;(void 0!==g||v)&&(r=m),void 0!==h&&(a=m);var y=0===o.length;return(_||y)&&void 0!==r&&(l.hasPrev=r),(p||y)&&void 0!==a&&(l.hasNext=a),l},messageSetPagination=function(e){var t,n,r;return e.parentSet.messages.length<e.returnedPage.length?(null===(r=e.logger)||void 0===r||r.call(e,"error","Corrupted message set state: parent set size < returned page size"),e.parentSet.pagination):null!==(t=e.messagePaginationOptions)&&void 0!==t&&t.created_at_around?messagePaginationCreatedAtAround(e):null!==(n=e.messagePaginationOptions)&&void 0!==n&&n.id_around?messagePaginationIdAround(e):messagePaginationLinear(e)},DEFAULT_QUERY_CHANNELS_MESSAGE_LIST_PAGE_SIZE=25,DEFAULT_QUERY_CHANNEL_MESSAGE_LIST_PAGE_SIZE=100,DEFAULT_MESSAGE_SET_PAGINATION={hasNext:!0,hasPrev:!0};function ownKeys$a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$a(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ChannelState=function(){function e(t){var n,r=this;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"_channel",void 0),_defineProperty__default.default(this,"watcher_count",void 0),_defineProperty__default.default(this,"typing",void 0),_defineProperty__default.default(this,"read",void 0),_defineProperty__default.default(this,"pinnedMessages",void 0),_defineProperty__default.default(this,"pending_messages",void 0),_defineProperty__default.default(this,"threads",void 0),_defineProperty__default.default(this,"mutedUsers",void 0),_defineProperty__default.default(this,"watchers",void 0),_defineProperty__default.default(this,"members",void 0),_defineProperty__default.default(this,"unreadCount",void 0),_defineProperty__default.default(this,"membership",void 0),_defineProperty__default.default(this,"last_message_at",void 0),_defineProperty__default.default(this,"isUpToDate",void 0),_defineProperty__default.default(this,"messageSets",[]),_defineProperty__default.default(this,"formatMessage",(function(e){return formatMessage(e)})),_defineProperty__default.default(this,"setIsUpToDate",(function(e){r.isUpToDate=e})),_defineProperty__default.default(this,"removeMessageFromArray",(function(e,t){var n=e.filter((function(e){return!(e.id&&t.id&&e.id===t.id)}));return{removed:n.length<e.length,result:n}})),_defineProperty__default.default(this,"updatePollVote",(function(e,t,n){var a,s=r.findMessage(n);if(s&&s.poll_id===e.poll_id){var i=_objectSpread$a({},t),o=_toConsumableArray__default.default((null===(a=s.poll)||void 0===a?void 0:a.own_votes)||[]);e.user_id===r._channel.getClient().userID&&(e.option_id&&t.enforce_unique_vote?o=o.filter((function(e){return!e.option_id})):e.answer_text&&(o=o.filter((function(e){return e.answer_text}))),o.push(e)),i.own_votes=o;var u=_objectSpread$a(_objectSpread$a({},s),{},{poll:i});r.addMessageSorted(u,!1,!1)}})),_defineProperty__default.default(this,"addPollVote",(function(e,t,n){var a,s=r.findMessage(n);if(s&&s.poll_id===e.poll_id){var i=_objectSpread$a({},t),o=_toConsumableArray__default.default((null===(a=s.poll)||void 0===a?void 0:a.own_votes)||[]);e.user_id===r._channel.getClient().userID&&o.push(e),i.own_votes=o;var u=_objectSpread$a(_objectSpread$a({},s),{},{poll:i});r.addMessageSorted(u,!1,!1)}})),_defineProperty__default.default(this,"removePollVote",(function(e,t,n){var a,s=r.findMessage(n);if(s&&s.poll_id===e.poll_id){var i=_objectSpread$a({},t),o=_toConsumableArray__default.default((null===(a=s.poll)||void 0===a?void 0:a.own_votes)||[]);if(e.user_id===r._channel.getClient().userID){var u=o.findIndex((function(t){return t.option_id===e.option_id}));u>-1&&o.splice(u,1)}i.own_votes=o;var l=_objectSpread$a(_objectSpread$a({},s),{},{poll:i});r.addMessageSorted(l,!1,!1)}})),_defineProperty__default.default(this,"updatePoll",(function(e,t){var n,a=r.findMessage(t);if(a){var s=_objectSpread$a(_objectSpread$a({},e),{},{own_votes:_toConsumableArray__default.default((null===(n=a.poll)||void 0===n?void 0:n.own_votes)||[])}),i=_objectSpread$a(_objectSpread$a({},a),{},{poll:s});r.addMessageSorted(i,!1,!1)}})),_defineProperty__default.default(this,"updateUserMessages",(function(e){var t=function(e,t){for(var n=0;n<e.length;n++){var r,a=e[n];(null===(r=a.user)||void 0===r?void 0:r.id)===t.id&&(e[n]=_objectSpread$a(_objectSpread$a({},a),{},{user:t}))}};for(var n in r.messageSets.forEach((function(n){return t(n.messages,e)})),r.threads)t(r.threads[n],e);t(r.pinnedMessages,e)})),_defineProperty__default.default(this,"deleteUserMessages",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<e.length;r++){var a,s=e[r];(null===(a=s.user)||void 0===a?void 0:a.id)===t.id&&(e[r]=n?{cid:s.cid,created_at:s.created_at,deleted_at:t.deleted_at,id:s.id,latest_reactions:[],mentioned_users:[],own_reactions:[],parent_id:s.parent_id,reply_count:s.reply_count,status:s.status,thread_participants:s.thread_participants,type:"deleted",updated_at:s.updated_at,user:s.user}:_objectSpread$a(_objectSpread$a({},s),{},{type:"deleted",deleted_at:t.deleted_at?new Date(t.deleted_at):null}))}};for(var a in r.messageSets.forEach((function(r){return n(r.messages,e,t)})),r.threads)n(r.threads[a],e,t);n(r.pinnedMessages,e,t)})),this._channel=t,this.watcher_count=0,this.typing={},this.read={},this.initMessages(),this.pinnedMessages=[],this.pending_messages=[],this.threads={},this.mutedUsers=[],this.watchers={},this.members={},this.membership={},this.unreadCount=0,this.isUpToDate=!0,this.last_message_at=null!=(null==t||null===(n=t.state)||void 0===n?void 0:n.last_message_at)?new Date(t.state.last_message_at):null}var t;return _createClass__default.default(e,[{key:"messages",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isCurrent})))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex((function(e){return e.isCurrent}));this.messageSets[t].messages=e}},{key:"latestMessages",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isLatest})))||void 0===e?void 0:e.messages)||[]},set:function(e){var t=this.messageSets.findIndex((function(e){return e.isLatest}));this.messageSets[t].messages=e}},{key:"messagePagination",get:function(){var e;return(null===(e=this.messageSets.find((function(e){return e.isCurrent})))||void 0===e?void 0:e.pagination)||DEFAULT_MESSAGE_SET_PAGINATION}},{key:"addMessageSorted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"latest";return this.addMessagesSorted([e],t,!1,n,r)}},{key:"addMessagesSorted",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"current",s=this.findTargetMessageSet(e,r,a),i=s.messagesToAdd,o=s.targetMessageSetIndex,u=0;u<i.length;u+=1){if(!i[u].shadowed){var l,c=void 0;if(i[u].created_at instanceof Date)c=i[u];else(c=this.formatMessage(i[u])).user&&null!==(l=this._channel)&&void 0!==l&&l.cid&&this._channel.getClient().state.updateUserReference(c.user,this._channel.cid),n&&c.id&&this.threads[c.id]&&delete this.threads[c.id],this.last_message_at||(this.last_message_at=new Date(c.created_at.getTime())),c.created_at.getTime()>this.last_message_at.getTime()&&(this.last_message_at=new Date(c.created_at.getTime()));var d=c.parent_id;if(d&&!c.show_in_channel||-1===o||(this.messageSets[o].messages=this._addToMessageList(this.messageSets[o].messages,c,t,"created_at",r)),d&&!n){var f=this.threads[d]||[];this.threads[d]=this._addToMessageList(f,c,t,"created_at",r)}}}return{messageSet:this.messageSets[o]}}},{key:"addPinnedMessages",value:function(e){for(var t=0;t<e.length;t+=1)this.addPinnedMessage(e[t])}},{key:"addPinnedMessage",value:function(e){this.pinnedMessages=this._addToMessageList(this.pinnedMessages,this.formatMessage(e),!1,"pinned_at")}},{key:"removePinnedMessage",value:function(e){var t=this.removeMessageFromArray(this.pinnedMessages,e).result;this.pinnedMessages=t}},{key:"addReaction",value:function(e,t,n){var r=this;if(t){var a=t;return this._updateMessage(t,(function(t){return a.own_reactions=r._addOwnReactionToMessage(t.own_reactions,e,n),r.formatMessage(a)})),a}}},{key:"_addOwnReactionToMessage",value:function(e,t,n){return e=(e=n?[]:this._removeOwnReactionFromMessage(e,t))||[],this._channel.getClient().userID===t.user_id&&e.push(t),e}},{key:"_removeOwnReactionFromMessage",value:function(e,t){return e?e.filter((function(e){return e.user_id!==t.user_id||e.type!==t.type})):e}},{key:"removeReaction",value:function(e,t){var n=this;if(t){var r=t;return this._updateMessage(t,(function(t){return r.own_reactions=n._removeOwnReactionFromMessage(t.own_reactions,e),n.formatMessage(r)})),r}}},{key:"_updateQuotedMessageReferences",value:function(e){var t=this,n=e.message,r=e.remove,a=function(e){var a=e.reduce((function(e,t){var a,s,i;return t.quoted_message_id===n.id&&e.push(_objectSpread$a(_objectSpread$a({},_objectSpread$a(_objectSpread$a({},a=t),{},{created_at:a.created_at.toISOString(),pinned_at:null===(s=a.pinned_at)||void 0===s?void 0:s.toISOString(),updated_at:null===(i=a.updated_at)||void 0===i?void 0:i.toISOString()})),{},{quoted_message:r?_objectSpread$a(_objectSpread$a({},n),{},{attachments:[]}):n})),e}),[]);t.addMessagesSorted(a,!0)};n.parent_id?n.parent_id&&this.threads[n.parent_id]&&a(this.threads[n.parent_id]):this.messageSets.forEach((function(e){return a(e.messages)}))}},{key:"removeQuotedMessageReferences",value:function(e){this._updateQuotedMessageReferences({message:e,remove:!0})}},{key:"_updateMessage",value:function(e,t){var n=e.parent_id,r=e.show_in_channel,a=e.pinned;if(n&&this.threads[n]){var s=this.threads[n],i=s.findIndex((function(t){return t.id===e.id}));-1!==i&&(s[i]=t(s[i]),this.threads[n]=s)}if(!r&&!n||r){var o=this.findMessageSetIndex(e);if(-1!==o){var u=this.messageSets[o].messages.findIndex((function(t){return t.id===e.id}));-1!==u&&(this.messageSets[o].messages[u]=t(this.messageSets[o].messages[u]))}}if(a){var l=this.pinnedMessages.findIndex((function(t){return t.id===e.id}));-1!==l&&(this.pinnedMessages[l]=t(this.pinnedMessages[l]))}}},{key:"_addToMessageList",value:function(e,t){return addToMessageList(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"created_at",!(arguments.length>4&&void 0!==arguments[4])||arguments[4])}},{key:"removeMessage",value:function(e){var t=!1;if(e.parent_id&&this.threads[e.parent_id]){var n=this.removeMessageFromArray(this.threads[e.parent_id],e),r=n.removed,a=n.result;this.threads[e.parent_id]=a,t=r}else{var s,i=null!==(s=e.messageSetIndex)&&void 0!==s?s:this.findMessageSetIndex(e);if(-1!==i){var o=this.removeMessageFromArray(this.messageSets[i].messages,e),u=o.removed,l=o.result;this.messageSets[i].messages=l,t=u}}return t}},{key:"filterErrorMessages",value:function(){var e=this.latestMessages.filter((function(e){return"error"!==e.type}));this.latestMessages=e}},{key:"clean",value:function(){for(var e=new Date,t=0,n=Object.entries(this.typing);t<n.length;t++){var r=_slicedToArray__default.default(n[t],2),a=r[0],s=r[1],i="string"==typeof s.received_at?new Date(s.received_at):s.received_at||new Date;e.getTime()-i.getTime()>7e3&&(delete this.typing[a],this._channel.getClient().dispatchEvent({cid:this._channel.cid,type:"typing.stop",user:{id:a}}))}}},{key:"clearMessages",value:function(){this.initMessages(),this.pinnedMessages=[]}},{key:"initMessages",value:function(){this.messageSets=[{messages:[],isLatest:!0,isCurrent:!0,pagination:DEFAULT_MESSAGE_SET_PAGINATION}]}},{key:"loadMessageIntoState",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a,s,i,o,u,l=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>2&&void 0!==l[2]?l[2]:25,i=!1,o=!1,u=n||t,"latest"!==t){e.next=10;break}if(this.messages!==this.latestMessages){e.next=7;break}return e.abrupt("return");case 7:s=this.messageSets.findIndex((function(e){return e.isLatest})),e.next=11;break;case 10:s=this.findMessageSetIndex({id:u});case 11:if(-1!==s&&(this.switchToMessageSet(s),i=!0),o=!n||!(null===(r=this.threads[n])||void 0===r||!r.find((function(e){return e.id===t}))),!i||!o){e.next=15;break}return e.abrupt("return");case 15:if(i){e.next=18;break}return e.next=18,this._channel.query({messages:{id_around:u,limit:a}},"new");case 18:if(o||!n){e.next=21;break}return e.next=21,this._channel.getReplies(n,{id_around:t,limit:a});case 21:-1!==(s=this.findMessageSetIndex({id:u}))&&this.switchToMessageSet(s);case 23:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"findMessage",value:function(e,t){if(t){var n=this.threads[t];if(!n)return;return n.find((function(t){return t.id===e}))}var r=this.findMessageSetIndex({id:e});if(-1!==r)return this.messageSets[r].messages.find((function(t){return t.id===e}))}},{key:"switchToMessageSet",value:function(e){var t=this.messageSets.find((function(e){return e.isCurrent}));t&&(t.isCurrent=!1,this.messageSets[e].isCurrent=!0)}},{key:"areMessageSetsOverlap",value:function(e,t){return e.some((function(e){return t.find((function(t){return e.id===t.id}))}))}},{key:"findMessageSetIndex",value:function(e){return this.messageSets.findIndex((function(t){return!!t.messages.find((function(t){return t.id===e.id}))}))}},{key:"findTargetMessageSet",value:function(e){var t,n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"current",a=e;if(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]){var s=this.messageSets.map((function(e,t){return t})).filter((function(t){return n.areMessageSetsOverlap(n.messageSets[t].messages,e)}));switch(r){case"new":s.length>0?t=s[0]:e.some((function(e){return!e.parent_id}))&&(this.messageSets.push({messages:[],isCurrent:!1,isLatest:!1,pagination:DEFAULT_MESSAGE_SET_PAGINATION}),t=this.messageSets.length-1);break;case"current":t=this.messageSets.findIndex((function(e){return e.isCurrent}));break;case"latest":t=this.messageSets.findIndex((function(e){return e.isLatest}));break;default:t=-1}var i=s.splice(0,1)[0],o=_toConsumableArray__default.default(s);if(void 0!==i&&i!==t&&o.push(t),o.length>0){var u=this.messageSets[i],l=this.messageSets.filter((function(e,t){return-1!==o.indexOf(t)}));l.forEach((function(e){u.isLatest=u.isLatest||e.isLatest,u.isCurrent=u.isCurrent||e.isCurrent,u.pagination.hasPrev=e.messages[0].created_at<u.messages[0].created_at?e.pagination.hasPrev:u.pagination.hasPrev,u.pagination.hasNext=u.messages.slice(-1)[0].created_at<e.messages.slice(-1)[0].created_at?e.pagination.hasNext:u.pagination.hasNext,a=[].concat(_toConsumableArray__default.default(a),_toConsumableArray__default.default(e.messages))})),l.forEach((function(e){return n.messageSets.splice(n.messageSets.indexOf(e),1)})),t=this.messageSets.findIndex((function(t){return n.areMessageSetsOverlap(t.messages,e)}))}}else t=this.findMessageSetIndex(e[0]);return{targetMessageSetIndex:t,messagesToAdd:a}}}]),e}();function _createForOfIteratorHelper$3(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$3(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function _unsupportedIterableToArray$3(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$3(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$3(e,t):void 0}}function _arrayLikeToArray$3(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys$9(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$9(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$9(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$9(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Channel=function(){function e(t,n,r,a){var s=this;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"_client",void 0),_defineProperty__default.default(this,"type",void 0),_defineProperty__default.default(this,"id",void 0),_defineProperty__default.default(this,"data",void 0),_defineProperty__default.default(this,"_data",void 0),_defineProperty__default.default(this,"cid",void 0),_defineProperty__default.default(this,"listeners",void 0),_defineProperty__default.default(this,"state",void 0),_defineProperty__default.default(this,"initialized",void 0),_defineProperty__default.default(this,"offlineMode",void 0),_defineProperty__default.default(this,"lastKeyStroke",void 0),_defineProperty__default.default(this,"lastTypingEvent",void 0),_defineProperty__default.default(this,"isTyping",void 0),_defineProperty__default.default(this,"disconnected",void 0),_defineProperty__default.default(this,"create",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_objectSpread$9(_objectSpread$9({},t),{},{watch:!1,state:!1,presence:!1}),e.next=3,s.query(n,"latest");case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"_callChannelListeners",(function(e){var t=s,n=[];t.listeners.all&&n.push.apply(n,_toConsumableArray__default.default(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,_toConsumableArray__default.default(t.listeners[e.type]));for(var r=0,a=n;r<a.length;r++){var i=a[r];"string"!=typeof i&&i(e)}})),_defineProperty__default.default(this,"_channelURL",(function(){if(!s.id)throw new Error("channel id is not defined");return"".concat(s.getClient().baseURL,"/channels/").concat(encodeURIComponent(s.type),"/").concat(encodeURIComponent(s.id))}));if(!/^[\w_-]+$/.test(n))throw new Error("Invalid chat type ".concat(n,', letters, numbers and "_-" are allowed'));if("string"==typeof r&&!/^[\w!_-]+$/.test(r))throw new Error("Invalid chat id ".concat(r,', letters, numbers and "!-_" are allowed'));this._client=t,this.type=n,this.id=r,this.data=a,this._data=_objectSpread$9({},a),this.cid="".concat(n,":").concat(r),this.listeners={},this.state=new ChannelState(this),this.initialized=!1,this.offlineMode=!1,this.lastTypingEvent=null,this.isTyping=!1,this.disconnected=!1}var t,n,r,a,s,i,o,u,l,c,d,f,_,p,h,g,v,m,y,b,w,k,R,S,C,x,T,P,U,I,j,A,O,E,M,L,D,G,$,F,q;return _createClass__default.default(e,[{key:"getClient",value:function(){if(!0===this.disconnected)throw Error("You can't use a channel after client.disconnect() was called");return this._client}},{key:"getConfig",value:function(){return this.getClient().configs[this.cid]}},{key:"sendMessage",value:(q=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/message",_objectSpread$9({message:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return q.apply(this,arguments)})},{key:"sendFile",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/file"),e,t,n,r)}},{key:"sendImage",value:function(e,t,n,r){return this.getClient().sendFile("".concat(this._channelURL(),"/image"),e,t,n,r)}},{key:"deleteFile",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/file"),{url:e})}},{key:"deleteImage",value:function(e){return this.getClient().delete("".concat(this._channelURL(),"/image"),{url:e})}},{key:"sendEvent",value:(F=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().post(this._channelURL()+"/event",{event:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"search",value:($=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=a.length>1&&void 0!==a[1]?a[1]:{}).offset||!n.next){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(r=_objectSpread$9(_objectSpread$9({filter_conditions:{cid:this.cid}},n),{},{sort:n.sort?normalizeQuerySort(n.sort):void 0}),"string"!=typeof t){e.next=8;break}r.query=t,e.next=13;break;case 8:if("object"!==_typeof__default.default(t)){e.next=12;break}r.message_filter_conditions=t,e.next=13;break;case 12:throw Error("Invalid type ".concat(_typeof__default.default(t)," for query parameter"));case 13:return e.next=15,this.getClient().wsPromise;case 15:return e.next=17,this.getClient().get(this.getClient().baseURL+"/search",{payload:r});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"queryMembers",value:(G=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s,i,o,u=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>1&&void 0!==u[1]?u[1]:[],a=u.length>2&&void 0!==u[2]?u[2]:{},i=this.type,this.id?s=this.id:null!==(n=this.data)&&void 0!==n&&n.members&&Array.isArray(this.data.members)&&(o=this.data.members),e.next=6,this.getClient().get(this.getClient().baseURL+"/members",{payload:_objectSpread$9({type:i,id:s,members:o,sort:normalizeQuerySort(r),filter_conditions:t},a)});case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"partialUpdateMember",value:(D=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the user id");case 2:return e.next=4,this.getClient().patch(this._channelURL()+"/member/".concat(encodeURIComponent(t)),n);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"sendReaction",value:(L=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Message id is missing");case 2:if(n&&0!==Object.keys(n).length){e.next=4;break}throw Error("Reaction object is missing");case 4:return e.next=6,this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/reaction"),_objectSpread$9({reaction:n},r));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return L.apply(this,arguments)})},{key:"deleteReaction",value:function(e,t,n){if(this._checkInitialized(),!t||!e)throw Error("Deleting a reaction requires specifying both the message and reaction type");var r=this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reaction/").concat(encodeURIComponent(t));return n?this.getClient().delete(r,{user_id:n}):this.getClient().delete(r,{})}},{key:"update",value:(M=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1?a[1]:void 0,r=a.length>2?a[2]:void 0,["config","cid","created_by","id","member_count","type","created_at","updated_at","last_message_at","own_capabilities"].forEach((function(e){delete t[e]})),e.next=7,this._update(_objectSpread$9({message:n,data:t},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"updatePartial",value:(E=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().patch(this._channelURL(),t);case 2:return a=e.sent,s=_toConsumableArray__default.default(a.channel.own_capabilities||[]).sort().join()!==_toConsumableArray__default.default(Array.isArray(null===(n=this.data)||void 0===n?void 0:n.own_capabilities)?null===(r=this.data)||void 0===r?void 0:r.own_capabilities:[]).sort().join(),this.data=a.channel,s&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:a.channel.own_capabilities}),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"enableSlowMode",value:(O=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:t});case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"disableSlowMode",value:(A=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),{cooldown:0});case 2:return t=e.sent,this.data=t.channel,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"delete",value:(j=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().delete(this._channelURL(),_objectSpread$9({},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return j.apply(this,arguments)})},{key:"truncate",value:(I=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this._channelURL()+"/truncate",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"acceptInvite",value:(U=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(_objectSpread$9({accept_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"rejectInvite",value:(P=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this._update(_objectSpread$9({reject_invite:!0},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return P.apply(this,arguments)})},{key:"addMembers",value:(T=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this._update(_objectSpread$9({add_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return T.apply(this,arguments)})},{key:"addModerators",value:(x=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this._update(_objectSpread$9({add_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"assignRoles",value:(C=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this._update(_objectSpread$9({assign_roles:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return C.apply(this,arguments)})},{key:"inviteMembers",value:(S=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this._update(_objectSpread$9({invites:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return S.apply(this,arguments)})},{key:"removeMembers",value:(R=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this._update(_objectSpread$9({remove_members:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"demoteModerators",value:(k=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this._update(_objectSpread$9({demote_moderators:t,message:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return k.apply(this,arguments)})},{key:"_update",value:(w=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL(),t);case 2:return n=e.sent,this.data=n.channel,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"mute",value:(b=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/mute/channel",_objectSpread$9({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"unmute",value:(y=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.getClient().post(this.getClient().baseURL+"/moderation/unmute/channel",_objectSpread$9({channel_cid:this.cid},t));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"muteStatus",value:function(){return this._checkInitialized(),this.getClient()._muteStatus(this.cid)}},{key:"sendAction",value:function(e,t){if(this._checkInitialized(),!e)throw Error("Message id is missing");return this.getClient().post(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/action"),{message_id:e,form_data:t,id:this.id,type:this.type})}},{key:"keystroke",value:(m=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:if(r=new Date,a=this.lastTypingEvent&&r.getTime()-this.lastTypingEvent.getTime(),this.lastKeyStroke=r,this.isTyping=!0,!(null===a||a>2e3)){e.next=10;break}return this.lastTypingEvent=new Date,e.next=10,this.sendEvent(_objectSpread$9({type:"typing.start",parent_id:t},n||{}));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return m.apply(this,arguments)})},{key:"stopTyping",value:(v=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isTypingIndicatorsEnabled()){e.next=2;break}return e.abrupt("return");case 2:return this.lastTypingEvent=null,this.isTyping=!1,e.next=6,this.sendEvent(_objectSpread$9({type:"typing.stop",parent_id:t},n||{}));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"_isTypingIndicatorsEnabled",value:function(){var e,t,n,r,a;return!(null===(e=this.getConfig())||void 0===e||!e.typing_events)&&(null===(t=null===(n=this.getClient().user)||void 0===n||null===(r=n.privacy_settings)||void 0===r||null===(a=r.typing_indicators)||void 0===a?void 0:a.enabled)||void 0===t||t)}},{key:"lastMessage",value:function(){var e=this.state.latestMessages.length-5;e<0&&(e=0);var t=this.state.latestMessages.length+1,n=this.state.latestMessages.slice(e,t);return n.sort((function(e,t){return t.created_at.getTime()-e.created_at.getTime()})),n[0]}},{key:"markRead",value:(g=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>0&&void 0!==r[0]?r[0]:{},this._checkInitialized(),null!==(t=this.getConfig())&&void 0!==t&&t.read_events||this.getClient()._isUsingServerAuth()){e.next=4;break}return e.abrupt("return",Promise.resolve(null));case 4:return e.next=6,this.getClient().post(this._channelURL()+"/read",_objectSpread$9({},n));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"markUnread",value:(h=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkInitialized(),null!==(n=this.getConfig())&&void 0!==n&&n.read_events||this.getClient()._isUsingServerAuth()){e.next=3;break}return e.abrupt("return",Promise.resolve(null));case 3:return e.next=5,this.getClient().post(this._channelURL()+"/unread",_objectSpread$9({},t));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"clean",value:function(){this.lastKeyStroke&&((new Date).getTime()-this.lastKeyStroke.getTime()>1e3&&this.isTyping&&logChatPromiseExecution(this.stopTyping(),"stop typing event"));this.state.clean()}},{key:"watch",value:(p=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={state:!0,watch:!0,presence:!1},e.next=3,this.getClient().wsPromise;case 3:return this.getClient()._hasConnectionID()||(n.watch=!1),r=_objectSpread$9(_objectSpread$9({},n),t),e.next=7,this.query(r,"latest");case 7:return a=e.sent,this.initialized=!0,this.data=a.channel,this._client.logger("info","channel:watch() - started watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"stopWatching",value:(_=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/stop-watching",{});case 2:return t=e.sent,this._client.logger("info","channel:watch() - stopped watching channel ".concat(this.cid),{tags:["channel"],channel:this}),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"getReplies",value:(f=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){var a,s;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r?normalizeQuerySort(r):void 0,e.next=3,this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(t),"/replies"),_objectSpread$9({sort:a},n));case 3:return(s=e.sent).messages&&this.state.addMessagesSorted(s.messages),e.abrupt("return",s);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return f.apply(this,arguments)})},{key:"getPinnedMessages",value:(d=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:[],e.next=3,this.getClient().get(this._channelURL()+"/pinned_messages",{payload:_objectSpread$9(_objectSpread$9({},t),{},{sort:normalizeQuerySort(n)})});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getReactions",value:function(e,t){return this.getClient().get(this.getClient().baseURL+"/messages/".concat(encodeURIComponent(e),"/reactions"),_objectSpread$9({},t))}},{key:"getMessagesById",value:function(e){return this.getClient().get(this._channelURL()+"/messages",{ids:e.join(",")})}},{key:"lastRead",value:function(){var e=this.getClient().userID;if(e)return this.state.read[e]?this.state.read[e].last_read:null}},{key:"_countMessageAsUnread",value:function(e){var t,n,r,a;return!e.shadowed&&(!e.silent&&(!(e.parent_id&&!e.show_in_channel)&&((null===(t=e.user)||void 0===t?void 0:t.id)!==this.getClient().userID&&((null===(n=e.user)||void 0===n||!n.id||!this.getClient().userMuteStatus(e.user.id))&&(!(Array.isArray(null===(r=this.data)||void 0===r?void 0:r.own_capabilities)&&(null===(a=this.data)||void 0===a||!a.own_capabilities.includes("read-events")))&&!this.muteStatus().muted)))))}},{key:"countUnread",value:function(e){if(!e)return this.state.unreadCount;for(var t=0,n=0;n<this.state.latestMessages.length;n+=1){var r=this.state.latestMessages[n];r.created_at>e&&this._countMessageAsUnread(r)&&t++}return t}},{key:"countUnreadMentions",value:function(){for(var e=this.lastRead(),t=this.getClient().userID,n=0,r=0;r<this.state.latestMessages.length;r+=1){var a,s=this.state.latestMessages[r];this._countMessageAsUnread(s)&&(!e||s.created_at>e)&&null!==(a=s.mentioned_users)&&void 0!==a&&a.some((function(e){return e.id===t}))&&n++}return n}},{key:"query",value:(c=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s,i,o,u,l,c,d,f,_,p=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=p.length>1&&void 0!==p[1]?p[1]:"current",e.next=3,this.getClient().wsPromise;case 3:return o="".concat(this.getClient().baseURL,"/channels/").concat(encodeURIComponent(this.type)),this.id&&(o+="/".concat(encodeURIComponent(this.id))),e.next=7,this.getClient().post(o+"/query",_objectSpread$9({data:this._data,state:!0},t));case 7:return u=e.sent,this.id||(this.id=u.channel.id,this.cid=u.channel.cid,l=u.members.map((function(e){var t;return e.user_id||(null===(t=e.user)||void 0===t?void 0:t.id)})).sort().join(","),(c="".concat(this.type,":!members-").concat(l))in this.getClient().activeChannels&&delete this.getClient().activeChannels[c],this.cid in this.getClient().activeChannels||(this.getClient().activeChannels[this.cid]=this)),this.getClient()._addChannelConfig(u.channel),d=this._initializeState(u,i),(f=d.messageSet).pagination=_objectSpread$9(_objectSpread$9({},f.pagination),messageSetPagination({parentSet:f,messagePaginationOptions:null==t?void 0:t.messages,requestedPageSize:null!==(n=null==t||null===(r=t.messages)||void 0===r?void 0:r.limit)&&void 0!==n?n:DEFAULT_QUERY_CHANNEL_MESSAGE_LIST_PAGE_SIZE,returnedPage:u.messages,logger:this.getClient().logger})),_=_toConsumableArray__default.default(u.channel.own_capabilities||[]).sort().join()!==_toConsumableArray__default.default(Array.isArray(null===(a=this.data)||void 0===a?void 0:a.own_capabilities)?null===(s=this.data)||void 0===s?void 0:s.own_capabilities:[]).sort().join(),this.data=u.channel,this.offlineMode=!1,_&&this.getClient().dispatchEvent({type:"capabilities.changed",cid:this.cid,own_capabilities:u.channel.own_capabilities}),this.getClient().dispatchEvent({type:"channels.queried",queriedChannels:{channels:[u],isLatestMessageSet:f.isLatest}}),e.abrupt("return",u);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"banUser",value:(l=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().banUser(t,_objectSpread$9(_objectSpread$9({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"hide",value:(u=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]&&r[1],this._checkInitialized(),e.next=5,this.getClient().post("".concat(this._channelURL(),"/hide"),{user_id:t,clear_history:n});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"show",value:(o=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,this._checkInitialized(),e.next=4,this.getClient().post("".concat(this._channelURL(),"/show"),{user_id:t});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"unbanUser",value:(i=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().unbanUser(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"shadowBan",value:(s=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().shadowBan(t,_objectSpread$9(_objectSpread$9({},n),{},{type:this.type,id:this.id}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"removeShadowBan",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._checkInitialized(),e.next=3,this.getClient().removeShadowBan(t,{type:this.type,id:this.id});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"createCall",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().post(this._channelURL()+"/call",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"vote",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().castPollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"removeVote",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getClient().removePollVote(t,n,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"on",value:function(e,t){var n=this,r=t?e:"all",a=t||e;return r in this.listeners||(this.listeners[r]=[]),this._client.logger("info","Attaching listener for ".concat(r," event on channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[r].push(a),{unsubscribe:function(){n._client.logger("info","Removing listener for ".concat(r," event from channel ").concat(n.cid),{tags:["event","channel"],channel:n}),n.listeners[r]=n.listeners[r].filter((function(e){return e!==a}))}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this._client.logger("info","Removing listener for ".concat(n," event from channel ").concat(this.cid),{tags:["event","channel"],channel:this}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_handleChannelEvent",value:function(e){var t,n,r,a,s,i,o,u,l,c,d,f,_=this;this._client.logger("info","channel:_handleChannelEvent - Received event of type { ".concat(e.type," } on ").concat(this.cid),{tags:["event","channel"],channel:this});var p=_.state;switch(e.type){case"typing.start":null!==(t=e.user)&&void 0!==t&&t.id&&(p.typing[e.user.id]=e);break;case"typing.stop":null!==(n=e.user)&&void 0!==n&&n.id&&delete p.typing[e.user.id];break;case"message.read":var h,g;if(null!==(r=e.user)&&void 0!==r&&r.id&&e.created_at)p.read[e.user.id]={last_read:new Date(e.created_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:0},(null===(h=e.user)||void 0===h?void 0:h.id)===(null===(g=this.getClient().user)||void 0===g?void 0:g.id)&&(p.unreadCount=0);break;case"user.watching.start":case"user.updated":null!==(a=e.user)&&void 0!==a&&a.id&&(p.watchers[e.user.id]=e.user);break;case"user.watching.stop":null!==(s=e.user)&&void 0!==s&&s.id&&delete p.watchers[e.user.id];break;case"message.deleted":e.message&&(this._extendEventWithOwnReactions(e),e.hard_delete?p.removeMessage(e.message):p.addMessageSorted(e.message,!1,!1),p.removeQuotedMessageReferences(e.message),e.message.pinned&&p.removePinnedMessage(e.message));break;case"message.new":if(e.message){var v,m,y,b=(null===(v=e.user)||void 0===v?void 0:v.id)===(null===(m=this.getClient().user)||void 0===m?void 0:m.id),w=e.message.parent_id&&!e.message.show_in_channel;if((this.state.isUpToDate||w)&&p.addMessageSorted(e.message,b),e.message.pinned&&p.addPinnedMessage(e.message),b||w)break;if(null!==(y=e.user)&&void 0!==y&&y.id)for(var k in p.read)k===e.user.id?p.read[e.user.id]={last_read:new Date(e.created_at),user:e.user,unread_messages:0}:p.read[k].unread_messages+=1;this._countMessageAsUnread(e.message)&&(p.unreadCount=p.unreadCount+1)}break;case"message.updated":case"message.undeleted":e.message&&(this._extendEventWithOwnReactions(e),p.addMessageSorted(e.message,!1,!1),p._updateQuotedMessageReferences({message:e.message}),e.message.pinned?p.addPinnedMessage(e.message):p.removePinnedMessage(e.message));break;case"channel.truncated":if(null!==(i=e.channel)&&void 0!==i&&i.truncated_at){var R=+new Date(e.channel.truncated_at);p.messageSets.forEach((function(e,t){e.messages.forEach((function(e){var n=e.created_at,r=e.id;R>+n&&p.removeMessage({id:r,messageSetIndex:t})}))})),p.pinnedMessages.forEach((function(e){var t=e.id,n=e.created_at;R>+n&&p.removePinnedMessage({id:t})}))}else p.clearMessages();p.unreadCount=0,e.message&&(p.addMessageSorted(e.message),e.message.pinned&&p.addPinnedMessage(e.message));break;case"member.added":case"member.updated":null!==(o=e.member)&&void 0!==o&&o.user_id&&(p.members[e.member.user_id]=e.member);break;case"member.removed":null!==(u=e.user)&&void 0!==u&&u.id&&delete p.members[e.user.id];break;case"notification.mark_unread":var S,C,x;if(!((null===(S=e.user)||void 0===S?void 0:S.id)===(null===(C=this.getClient().user)||void 0===C?void 0:C.id))||!e.user)break;var T=null!==(x=e.unread_messages)&&void 0!==x?x:0;p.read[e.user.id]={first_unread_message_id:e.first_unread_message_id,last_read:new Date(e.last_read_at),last_read_message_id:e.last_read_message_id,user:e.user,unread_messages:T},p.unreadCount=T;break;case"channel.updated":var P,U,I,j,A,O,E,M;if(e.channel)void 0!==(null===(P=e.channel)||void 0===P?void 0:P.frozen)&&e.channel.frozen!==(null===(U=_.data)||void 0===U?void 0:U.frozen)&&this.query({state:!1,messages:{limit:0},watchers:{limit:0}}),_.data=_objectSpread$9(_objectSpread$9({},e.channel),{},{hidden:null!==(I=null===(j=e.channel)||void 0===j?void 0:j.hidden)&&void 0!==I?I:null===(A=_.data)||void 0===A?void 0:A.hidden,own_capabilities:null!==(O=null===(E=e.channel)||void 0===E?void 0:E.own_capabilities)&&void 0!==O?O:null===(M=_.data)||void 0===M?void 0:M.own_capabilities});break;case"poll.updated":var L;if(e.poll)p.updatePoll(e.poll,(null===(L=e.message)||void 0===L?void 0:L.id)||"");break;case"poll.vote_casted":var D;if(e.poll_vote&&e.poll)p.addPollVote(e.poll_vote,e.poll,(null===(D=e.message)||void 0===D?void 0:D.id)||"");break;case"poll.vote_changed":var G;if(e.poll_vote&&e.poll)p.updatePollVote(e.poll_vote,e.poll,(null===(G=e.message)||void 0===G?void 0:G.id)||"");break;case"poll.vote_removed":var $;if(e.poll_vote&&e.poll)p.removePollVote(e.poll_vote,e.poll,(null===($=e.message)||void 0===$?void 0:$.id)||"");break;case"poll.closed":e.message&&p.addMessageSorted(e.message,!1,!1);break;case"reaction.new":e.message&&e.reaction&&(e.message=p.addReaction(e.reaction,e.message));break;case"reaction.deleted":e.reaction&&(e.message=p.removeReaction(e.reaction,e.message));break;case"reaction.updated":e.reaction&&(e.message=p.addReaction(e.reaction,e.message,!0));break;case"channel.hidden":_.data=_objectSpread$9(_objectSpread$9({},_.data),{},{hidden:!0}),e.clear_history&&p.clearMessages();break;case"channel.visible":_.data=_objectSpread$9(_objectSpread$9({},_.data),{},{hidden:!1});break;case"user.banned":if(null===(l=e.user)||void 0===l||!l.id)break;p.members[e.user.id]=_objectSpread$9(_objectSpread$9({},p.members[e.user.id]||{}),{},{shadow_banned:!!e.shadow,banned:!e.shadow,user:_objectSpread$9(_objectSpread$9({},(null===(c=p.members[e.user.id])||void 0===c?void 0:c.user)||{}),e.user)});break;case"user.unbanned":if(null===(d=e.user)||void 0===d||!d.id)break;p.members[e.user.id]=_objectSpread$9(_objectSpread$9({},p.members[e.user.id]||{}),{},{shadow_banned:!1,banned:!1,user:_objectSpread$9(_objectSpread$9({},(null===(f=p.members[e.user.id])||void 0===f?void 0:f.user)||{}),e.user)})}void 0!==e.watcher_count&&(_.state.watcher_count=e.watcher_count)}},{key:"_checkInitialized",value:function(){if(!this.initialized&&!this.offlineMode&&!this.getClient()._isUsingServerAuth())throw Error("Channel ".concat(this.cid," hasn't been initialized yet. Make sure to call .watch() and wait for it to resolve"))}},{key:"_initializeState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"latest",n=this.getClient(),r=n.state,a=n.user,s=n.userID;if(e.members){var i,o=_createForOfIteratorHelper$3(e.members);try{for(o.s();!(i=o.n()).done;){var u=i.value;u.user&&r.updateUserReference(u.user,this.cid)}}catch(e){o.e(e)}finally{o.f()}}this.state.membership=e.membership||{};var l=e.messages||[];this.state.messages||this.state.initMessages();var c=this.state.addMessagesSorted(l,!1,!0,!0,t).messageSet;if(this.state.pinnedMessages||(this.state.pinnedMessages=[]),this.state.addPinnedMessages(e.pinned_messages||[]),e.pending_messages&&(this.state.pending_messages=e.pending_messages),void 0!==e.watcher_count&&(this.state.watcher_count=e.watcher_count),e.watchers){var d,f=_createForOfIteratorHelper$3(e.watchers);try{for(f.s();!(d=f.n()).done;){var _=d.value;_&&(r.updateUserReference(_,this.cid),this.state.watchers[_.id]=_)}}catch(e){f.e(e)}finally{f.f()}}if(null!=s){var p=this.state.last_message_at||new Date;a&&(this.state.read[a.id]={user:a,last_read:p,unread_messages:0})}if(e.read){var h,g=_createForOfIteratorHelper$3(e.read);try{for(g.s();!(h=g.n()).done;){var v,m=h.value;this.state.read[m.user.id]={last_read:new Date(m.last_read),last_read_message_id:m.last_read_message_id,unread_messages:null!==(v=m.unread_messages)&&void 0!==v?v:0,user:m.user},m.user.id===(null==a?void 0:a.id)&&(this.state.unreadCount=this.state.read[m.user.id].unread_messages)}}catch(e){g.e(e)}finally{g.f()}}return e.members&&this._hydrateMembers(e.members),{messageSet:c}}},{key:"_extendEventWithOwnReactions",value:function(e){if(e.message){var t=this.state.findMessage(e.message.id,e.message.parent_id);t&&(e.message.own_reactions=t.own_reactions)}}},{key:"_hydrateMembers",value:function(e){this.state.members=e.reduce((function(e,t){return t.user&&(e[t.user.id]=t),e}),{})}},{key:"_disconnect",value:function(){this._client.logger("info","channel:disconnect() - Disconnecting the channel ".concat(this.cid),{tags:["connection","channel"],channel:this}),this.disconnected=!0,this.state.setIsUpToDate(!1)}}]),e}();function _createForOfIteratorHelper$2(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$2(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function _unsupportedIterableToArray$2(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$2(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$2(e,t):void 0}}function _arrayLikeToArray$2(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ClientState=function(){function e(){_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"users",void 0),_defineProperty__default.default(this,"userChannelReferences",void 0),this.users={},this.userChannelReferences={}}return _createClass__default.default(e,[{key:"updateUsers",value:function(e){var t,n=_createForOfIteratorHelper$2(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.updateUser(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"updateUser",value:function(e){null!=e&&(this.users[e.id]=e)}},{key:"updateUserReference",value:function(e,t){null!=e&&(this.updateUser(e),this.userChannelReferences[e.id]||(this.userChannelReferences[e.id]={}),this.userChannelReferences[e.id][t]=!0)}},{key:"deleteAllChannelReference",value:function(e){for(var t in this.userChannelReferences)delete this.userChannelReferences[t][e]}}]),e}();function ownKeys$8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$8(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$8(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$8(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var InsightMetrics=function e(){_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"connectionStartTimestamp",void 0),_defineProperty__default.default(this,"wsConsecutiveFailures",void 0),_defineProperty__default.default(this,"wsTotalFailures",void 0),_defineProperty__default.default(this,"instanceClientId",void 0),this.connectionStartTimestamp=null,this.wsTotalFailures=0,this.wsConsecutiveFailures=0,this.instanceClientId=randomId()},postInsights=function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=3,a=0;case 2:if(!(a<r)){e.next=17;break}return e.prev=3,e.next=6,axios__default.default.post("https://chat-insights.getstream.io/insights/".concat(t),n);case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,sleep(3e3*(a+1));case 12:return e.abrupt("continue",14);case 13:return e.abrupt("break",17);case 14:a++,e.next=2;break;case 17:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t,n){return e.apply(this,arguments)}}();function buildWsFatalInsight(e,t){return _objectSpread$8(_objectSpread$8({},t),buildWsBaseInsight(e))}function buildWsBaseInsight(e){var t,n,r,a=e.client;return{ready_state:null===(t=e.ws)||void 0===t?void 0:t.readyState,url:e._buildUrl(),api_key:a.key,start_ts:a.insightMetrics.connectionStartTimestamp,end_ts:(new Date).getTime(),auth_type:a.getAuthType(),token:a.tokenManager.token,user_id:a.userID,user_details:a._user,device:a.options.device,client_id:e.connectionID,ws_details:e.ws,ws_consecutive_failures:a.insightMetrics.wsConsecutiveFailures,ws_total_failures:a.insightMetrics.wsTotalFailures,request_id:e.requestID,online:"undefined"!=typeof navigator?null===(n=navigator)||void 0===n?void 0:n.onLine:null,user_agent:"undefined"!=typeof navigator?null===(r=navigator)||void 0===r?void 0:r.userAgent:null,instance_client_id:a.insightMetrics.instanceClientId}}function buildWsSuccessAfterFailureInsight(e){return buildWsBaseInsight(e)}function ownKeys$7(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$7(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$7(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$7(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var isCloseEvent=function(e){return void 0!==e.code},isErrorEvent=function(e){return void 0!==e.error},StableWSConnection=function(){function e(t){var n=this,r=t.client;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"client",void 0),_defineProperty__default.default(this,"connectionID",void 0),_defineProperty__default.default(this,"connectionOpen",void 0),_defineProperty__default.default(this,"consecutiveFailures",void 0),_defineProperty__default.default(this,"pingInterval",void 0),_defineProperty__default.default(this,"healthCheckTimeoutRef",void 0),_defineProperty__default.default(this,"isConnecting",void 0),_defineProperty__default.default(this,"isDisconnected",void 0),_defineProperty__default.default(this,"isHealthy",void 0),_defineProperty__default.default(this,"isResolved",void 0),_defineProperty__default.default(this,"lastEvent",void 0),_defineProperty__default.default(this,"connectionCheckTimeout",void 0),_defineProperty__default.default(this,"connectionCheckTimeoutRef",void 0),_defineProperty__default.default(this,"rejectPromise",void 0),_defineProperty__default.default(this,"requestID",void 0),_defineProperty__default.default(this,"resolvePromise",void 0),_defineProperty__default.default(this,"totalFailures",void 0),_defineProperty__default.default(this,"ws",void 0),_defineProperty__default.default(this,"wsID",void 0),_defineProperty__default.default(this,"_buildUrl",(function(){var e=encodeURIComponent(n.client._buildWSPayload(n.requestID)),t=n.client.tokenManager.getToken();return"".concat(n.client.wsBaseURL,"/connect?json=").concat(e,"&api_key=").concat(n.client.key,"&authorization=").concat(t,"&stream-auth-type=").concat(n.client.getAuthType(),"&X-Stream-Client=").concat(n.client.getUserAgent())})),_defineProperty__default.default(this,"onlineStatusChanged",(function(e){"offline"===e.type?(n._log("onlineStatusChanged() - Status changing to offline"),n._setHealth(!1)):"online"===e.type&&(n._log("onlineStatusChanged() - Status changing to online. isHealthy: ".concat(n.isHealthy)),n.isHealthy||n._reconnect({interval:10}))})),_defineProperty__default.default(this,"onopen",(function(e){n.wsID===e&&n._log("onopen() - onopen callback",{wsID:e})})),_defineProperty__default.default(this,"onmessage",(function(e,t){if(n.wsID===e){n._log("onmessage() - onmessage callback",{event:t,wsID:e});var r="string"==typeof t.data?JSON.parse(t.data):null;if(!n.isResolved&&r){var a,s;if(n.isResolved=!0,r.error)return void(null===(s=n.rejectPromise)||void 0===s||s.call(n,n._errorFromWSEvent(r,!1)));null===(a=n.resolvePromise)||void 0===a||a.call(n,r),n._setHealth(!0)}n.lastEvent=new Date,r&&"health.check"===r.type&&n.scheduleNextPing(),n.client.handleEvent(t),n.scheduleConnectionCheck()}})),_defineProperty__default.default(this,"onclose",(function(e,t){if(n.wsID===e)if(n._log("onclose() - onclose callback - "+t.code,{event:t,wsID:e}),t.code===chatCodes.WS_CLOSED_SUCCESS){var r,a=new Error("WS connection reject with error ".concat(t.reason));a.reason=t.reason,a.code=t.code,a.wasClean=t.wasClean,a.target=t.target,null===(r=n.rejectPromise)||void 0===r||r.call(n,a),n._log("onclose() - WS connection reject with error ".concat(t.reason),{event:t})}else{var s;n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.isConnecting=!1,null===(s=n.rejectPromise)||void 0===s||s.call(n,n._errorFromWSEvent(t)),n._log("onclose() - WS connection closed. Calling reconnect ...",{event:t}),n._reconnect()}})),_defineProperty__default.default(this,"onerror",(function(e,t){var r;n.wsID===e&&(n.consecutiveFailures+=1,n.totalFailures+=1,n._setHealth(!1),n.isConnecting=!1,null===(r=n.rejectPromise)||void 0===r||r.call(n,n._errorFromWSEvent(t)),n._log("onerror() - WS connection resulted into error",{event:t}),n._reconnect())})),_defineProperty__default.default(this,"_setHealth",(function(e){e!==n.isHealthy&&(n.isHealthy=e,n.isHealthy?n.client.dispatchEvent({type:"connection.changed",online:n.isHealthy}):setTimeout((function(){n.isHealthy||n.client.dispatchEvent({type:"connection.changed",online:n.isHealthy})}),5e3))})),_defineProperty__default.default(this,"_errorFromWSEvent",(function(e){var t,r,a,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];isCloseEvent(e)&&(t=e.code,r="unknown",a=e.reason),isErrorEvent(e)&&(t=e.error.code,r=e.error.StatusCode,a=e.error.message),n._log("_errorFromWSEvent() - WS failed with code ".concat(t),{event:e},"warn");var i=new Error("WS failed with code ".concat(t," and reason - ").concat(a));return i.code=t,i.StatusCode=r,i.isWSFailure=s,i})),_defineProperty__default.default(this,"_setupConnectionPromise",(function(){n.isResolved=!1,n.connectionOpen=new Promise((function(e,t){n.resolvePromise=e,n.rejectPromise=t}))})),_defineProperty__default.default(this,"scheduleNextPing",(function(){n.healthCheckTimeoutRef&&clearTimeout(n.healthCheckTimeoutRef),n.healthCheckTimeoutRef=setTimeout((function(){var e=[{type:"health.check",client_id:n.client.clientID}];try{var t;null===(t=n.ws)||void 0===t||t.send(JSON.stringify(e))}catch(e){}}),n.pingInterval)})),_defineProperty__default.default(this,"scheduleConnectionCheck",(function(){n.connectionCheckTimeoutRef&&clearTimeout(n.connectionCheckTimeoutRef),n.connectionCheckTimeoutRef=setTimeout((function(){var e=new Date;n.lastEvent&&e.getTime()-n.lastEvent.getTime()>n.connectionCheckTimeout&&(n._log("scheduleConnectionCheck - going to reconnect"),n._setHealth(!1),n._reconnect())}),n.connectionCheckTimeout)})),this.client=r,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.isDisconnected=!1,this.isResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,addConnectionEventListeners(this.onlineStatusChanged)}var t,n,r,a;return _createClass__default.default(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"connection:"+e,_objectSpread$7({tags:["connection"]},t))}},{key:"setClient",value:function(e){this.client=e}},{key:"connect",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:15e3,!this.isConnecting){e.next=3;break}throw Error("You've called connect twice, can only attempt 1 connection at the time");case 3:return this.isDisconnected=!1,e.prev=4,e.next=7,this._connect();case 7:n=e.sent,this.consecutiveFailures=0,this._log("connect() - Established ws connection with healthcheck: ".concat(n)),e.next=23;break;case 12:if(e.prev=12,e.t0=e.catch(4),this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==chatCodes.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){e.next=21;break}this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}),e.next=23;break;case 21:if(e.t0.isWSFailure){e.next=23;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 23:return e.next=25,this._waitForHealthy(t);case 25:return e.abrupt("return",e.sent);case 26:case"end":return e.stop()}}),e,this,[[4,12]])}))),function(){return a.apply(this,arguments)})},{key:"_waitForHealthy",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=this,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:15e3,e.abrupt("return",Promise.race([_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=50,a=0;case 2:if(!(a<=t)){e.next=18;break}return e.prev=3,e.next=6,n.connectionOpen;case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),a!==t){e.next=13;break}throw new Error(JSON.stringify({code:e.t0.code,StatusCode:e.t0.StatusCode,message:e.t0.message,isWSFailure:e.t0.isWSFailure}));case 13:return e.next=15,sleep(r);case 15:a+=r,e.next=2;break;case 18:case"end":return e.stop()}}),e,null,[[3,9]])})))(),_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sleep(t);case 2:throw n.isConnecting=!1,new Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}));case 4:case"end":return e.stop()}}),e)})))()]));case 2:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"disconnect",value:function(e){var t,n=this;this._log("disconnect() - Closing the websocket connection for wsID ".concat(this.wsID)),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),removeConnectionEventListeners(this.onlineStatusChanged),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();var r=this.ws;return r&&r.close&&r.readyState===r.OPEN?(t=new Promise((function(t){var a=function(e){n._log("disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{event:e}),t()};r.onclose=a,setTimeout(a,null!=e?e:1e3)})),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),r.close(chatCodes.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}},{key:"_connect",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.isConnecting||this.isDisconnected&&this.client.options.enableWSFallback)){e.next=2;break}return e.abrupt("return");case 2:return this.isConnecting=!0,this.requestID=randomId(),this.client.insightMetrics.connectionStartTimestamp=(new Date).getTime(),t=!1,e.prev=6,this._log("_connect() - waiting for token"),e.next=10,this.client.tokenManager.tokenReady();case 10:t=!0,e.next=15;break;case 13:e.prev=13,e.t0=e.catch(6);case 15:if(e.prev=15,t){e.next=20;break}return this._log("_connect() - tokenProvider failed before, so going to retry"),e.next=20,this.client.tokenManager.loadToken();case 20:return this._setupConnectionPromise(),n=this._buildUrl(),this._log("_connect() - Connecting to ".concat(n),{wsURL:n,requestID:this.requestID}),this.ws=new WebSocket__default.default(n),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID),e.next=30,this.connectionOpen;case 30:if(r=e.sent,this.isConnecting=!1,!r){e.next=36;break}return this.connectionID=r.connection_id,this.client.insightMetrics.wsConsecutiveFailures>0&&this.client.options.enableInsights&&(postInsights("ws_success_after_failure",buildWsSuccessAfterFailureInsight(this)),this.client.insightMetrics.wsConsecutiveFailures=0),e.abrupt("return",r);case 36:e.next=44;break;case 38:throw e.prev=38,e.t1=e.catch(15),this.isConnecting=!1,this._log("_connect() - Error - ",e.t1),this.client.options.enableInsights&&(this.client.insightMetrics.wsConsecutiveFailures++,this.client.insightMetrics.wsTotalFailures++,a=buildWsFatalInsight(this,convertErrorToJson(e.t1)),null==postInsights||postInsights("ws_fatal",a)),e.t1;case 44:case"end":return e.stop()}}),e,this,[[6,13],[15,38]])}))),function(){return n.apply(this,arguments)})},{key:"_reconnect",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this._log("_reconnect() - Initiating the reconnect"),!this.isConnecting&&!this.isHealthy){e.next=5;break}return this._log("_reconnect() - Abort (1) since already connecting or healthy"),e.abrupt("return");case 5:return(n=t.interval)||(n=retryInterval(this.consecutiveFailures)),e.next=9,sleep(n);case 9:if(!this.isConnecting&&!this.isHealthy){e.next=12;break}return this._log("_reconnect() - Abort (2) since already connecting or healthy"),e.abrupt("return");case 12:if(!this.isDisconnected||!this.client.options.enableWSFallback){e.next=15;break}return this._log("_reconnect() - Abort (3) since disconnect() is called"),e.abrupt("return");case 15:if(this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),!t.refreshToken){e.next=20;break}return e.next=20,this.client.tokenManager.loadToken();case 20:return e.prev=20,e.next=23,this._connect();case 23:return this._log("_reconnect() - Waiting for recoverCallBack"),e.next=26,this.client.recoverState();case 26:this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0,e.next=38;break;case 30:if(e.prev=30,e.t0=e.catch(20),this.isHealthy=!1,this.consecutiveFailures+=1,e.t0.code!==chatCodes.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){e.next=37;break}return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),e.abrupt("return",this._reconnect({refreshToken:!0}));case 37:e.t0.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect());case 38:this._log("_reconnect() - == END ==");case 39:case"end":return e.stop()}}),e,this,[[20,30]])}))),function(){return t.apply(this,arguments)})},{key:"_destroyCurrentWSConnection",value:function(){this.wsID+=1;try{var e,t;null==this||null===(e=this.ws)||void 0===e||e.removeAllListeners(),null==this||null===(t=this.ws)||void 0===t||t.close()}catch(e){}}}]),e}(),jwt=null,crypto$1=null;function ownKeys$6(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$6(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$6(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$6(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function JWTUserToken(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof t)throw new TypeError("userId should be a string");_objectSpread$6({user_id:t},n);throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function JWTServerToken(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=_extends__default.default({algorithm:"HS256",noTimestamp:!0},t);return jwt.sign({server:!0},e,n)}function UserFromToken(e){var t=e.split(".");if(3!==t.length)return"";var n=t[1],r=decodeBase64(n);return JSON.parse(r).user_id}function DevToken(e){return["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",encodeBase64(JSON.stringify({user_id:e})),"devtoken"].join(".")}function CheckSignature(e,t,n){var r=Buffer.from(t,"utf8"),a=crypto$1.createHmac("sha256",r).update(e).digest("hex");try{return crypto$1.timingSafeEqual(Buffer.from(a),Buffer.from(n))}catch(e){return!1}}var ConnectionState,TokenManager=function e(t){var n=this;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"loadTokenPromise",void 0),_defineProperty__default.default(this,"type",void 0),_defineProperty__default.default(this,"secret",void 0),_defineProperty__default.default(this,"token",void 0),_defineProperty__default.default(this,"tokenProvider",void 0),_defineProperty__default.default(this,"user",void 0),_defineProperty__default.default(this,"setTokenOrProvider",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.validateToken(t,r),n.user=r,isFunction(t)&&(n.tokenProvider=t,n.type="provider"),"string"==typeof t&&(n.token=t,n.type="static"),!t&&n.user&&n.secret&&(n.token=JWTUserToken(n.secret,r.id,{},{}),n.type="static"),e.next=7,n.loadToken();case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"reset",(function(){n.token=void 0,n.user=void 0,n.loadTokenPromise=null})),_defineProperty__default.default(this,"validateToken",(function(e,t){if(!t||!t.anon||e){if(!n.secret&&!e)throw new Error("User token can not be empty");if(e&&"string"!=typeof e&&!isFunction(e))throw new Error("user token should either be a string or a function");if("string"==typeof e){if(t.anon&&""===e)return;var r=UserFromToken(e);if(null!=e&&(null==r||""===r||r!==t.id))throw new Error("userToken does not have a user_id or is not matching with user.id")}}})),_defineProperty__default.default(this,"tokenReady",(function(){return n.loadTokenPromise})),_defineProperty__default.default(this,"loadToken",(function(){return n.loadTokenPromise=new Promise(function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("static"!==n.type){e.next=2;break}return e.abrupt("return",t(n.token));case 2:if(!n.tokenProvider||"string"==typeof n.tokenProvider){e.next=13;break}return e.prev=3,e.next=6,n.tokenProvider();case 6:n.token=e.sent,e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(3),e.abrupt("return",r(new Error("Call to tokenProvider failed with message: ".concat(e.t0))));case 12:t(n.token);case 13:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t,n){return e.apply(this,arguments)}}()),n.loadTokenPromise})),_defineProperty__default.default(this,"getToken",(function(){if(n.token)return n.token;if(n.user&&n.user.anon&&!n.token)return n.token;if(n.secret)return JWTServerToken(n.secret);throw new Error("Both secret and user tokens are not set. Either client.connectUser wasn't called or client.disconnect was called")})),_defineProperty__default.default(this,"isStatic",(function(){return"static"===n.type})),this.loadTokenPromise=null,t&&(this.secret=t),this.type="static",this.secret&&(this.token=JWTServerToken(this.secret))},APIErrorCodes={"-1":{name:"InternalSystemError",retryable:!0},2:{name:"AccessKeyError",retryable:!1},3:{name:"AuthenticationFailedError",retryable:!0},4:{name:"InputError",retryable:!1},6:{name:"DuplicateUsernameError",retryable:!1},9:{name:"RateLimitError",retryable:!0},16:{name:"DoesNotExistError",retryable:!1},17:{name:"NotAllowedError",retryable:!1},18:{name:"EventNotSupportedError",retryable:!1},19:{name:"ChannelFeatureNotSupportedError",retryable:!1},20:{name:"MessageTooLongError",retryable:!1},21:{name:"MultipleNestingLevelError",retryable:!1},22:{name:"PayloadTooBigError",retryable:!1},23:{name:"RequestTimeoutError",retryable:!0},24:{name:"MaxHeaderSizeExceededError",retryable:!1},40:{name:"AuthErrorTokenExpired",retryable:!1},41:{name:"AuthErrorTokenNotValidYet",retryable:!1},42:{name:"AuthErrorTokenUsedBeforeIssuedAt",retryable:!1},43:{name:"AuthErrorTokenSignatureInvalid",retryable:!1},44:{name:"CustomCommandEndpointMissingError",retryable:!1},45:{name:"CustomCommandEndpointCallError",retryable:!0},46:{name:"ConnectionIDNotFoundError",retryable:!1},60:{name:"CoolDownError",retryable:!0},69:{name:"ErrWrongRegion",retryable:!1},70:{name:"ErrQueryChannelPermissions",retryable:!1},71:{name:"ErrTooManyConnections",retryable:!0},99:{name:"AppSuspendedError",retryable:!1}};function isAPIError(e){return void 0!==e.code}function isErrorRetryable(e){if(!e.code)return!1;var t=APIErrorCodes["".concat(e.code)];return!!t&&t.retryable}function isConnectionIDError(e){return 46===e.code}function isWSFailure(e){if("boolean"==typeof e.isWSFailure)return e.isWSFailure;try{return JSON.parse(e.message).isWSFailure}catch(e){return!1}}function isErrorResponse(e){return!e.status||e.status<200||300<=e.status}function ownKeys$5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$5(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$5(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$5(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Closed="CLOSED",e.Connected="CONNECTED",e.Connecting="CONNECTING",e.Disconnected="DISCONNECTED",e.Init="INIT"}(ConnectionState||(ConnectionState={}));var WSConnectionFallback=function(){function e(t){var n=this,r=t.client;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"client",void 0),_defineProperty__default.default(this,"state",void 0),_defineProperty__default.default(this,"consecutiveFailures",void 0),_defineProperty__default.default(this,"connectionID",void 0),_defineProperty__default.default(this,"cancelToken",void 0),_defineProperty__default.default(this,"_onlineStatusChanged",(function(e){var t;if(n._log("_onlineStatusChanged() - ".concat(e.type)),"offline"===e.type)return n._setState(ConnectionState.Closed),null===(t=n.cancelToken)||void 0===t||t.cancel("disconnect() is called"),void(n.cancelToken=void 0);"online"===e.type&&n.state===ConnectionState.Closed&&n.connect(!0)})),_defineProperty__default.default(this,"_req",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,r,a){var s,i;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.cancelToken||t.close||(n.cancelToken=axios__default.default.CancelToken.source()),e.prev=1,e.next=4,n.client.doAxiosRequest("get",n.client.baseURL.replace(":3030",":8900")+"/longpoll",void 0,{config:_objectSpread$5(_objectSpread$5({},r),{},{cancelToken:null===(s=n.cancelToken)||void 0===s?void 0:s.token}),params:t});case 4:return i=e.sent,n.consecutiveFailures=0,e.abrupt("return",i);case 9:if(e.prev=9,e.t0=e.catch(1),n.consecutiveFailures+=1,!a||!isErrorRetryable(e.t0)){e.next=17;break}return n._log("_req() - Retryable error, retrying request"),e.next=16,sleep(retryInterval(n.consecutiveFailures));case 16:return e.abrupt("return",n._req(t,r,a));case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,n,r){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"_poll",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.state!==ConnectionState.Connected){e.next=25;break}return e.prev=1,e.next=4,n._req({},{timeout:3e4},!0);case 4:if(r=e.sent,null!==(t=r.events)&&void 0!==t&&t.length)for(a=0;a<r.events.length;a++)n.client.dispatchEvent(r.events[a]);e.next=23;break;case 8:if(e.prev=8,e.t0=e.catch(1),!axios__default.default.isCancel(e.t0)){e.next=13;break}return n._log("_poll() - axios canceled request"),e.abrupt("return");case 13:if(!isConnectionIDError(e.t0)){e.next=18;break}return n._log("_poll() - ConnectionID error, connecting without ID..."),n._setState(ConnectionState.Disconnected),n.connect(!0),e.abrupt("return");case 18:if(!isAPIError(e.t0)||isErrorRetryable(e.t0)){e.next=21;break}return n._setState(ConnectionState.Closed),e.abrupt("return");case 21:return e.next=23,sleep(retryInterval(n.consecutiveFailures));case 23:e.next=0;break;case 25:case"end":return e.stop()}}),e,null,[[1,8]])})))),_defineProperty__default.default(this,"connect",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,a,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]&&s[0],n.state!==ConnectionState.Connecting){e.next=4;break}return n._log("connect() - connecting already in progress",{reconnect:t},"warn"),e.abrupt("return");case 4:if(n.state!==ConnectionState.Connected){e.next=7;break}return n._log("connect() - already connected and polling",{reconnect:t},"warn"),e.abrupt("return");case 7:return n._setState(ConnectionState.Connecting),n.connectionID=void 0,e.prev=9,e.next=12,n._req({json:n.client._buildWSPayload()},{timeout:8e3},t);case 12:return r=e.sent,a=r.event,n._setState(ConnectionState.Connected),n.connectionID=a.connection_id,n.client.dispatchEvent(a),n._poll(),t&&n.client.recoverState(),e.abrupt("return",a);case 22:throw e.prev=22,e.t0=e.catch(9),n._setState(ConnectionState.Closed),e.t0;case 26:case"end":return e.stop()}}),e,null,[[9,22]])})))),_defineProperty__default.default(this,"isHealthy",(function(){return!!n.connectionID&&n.state===ConnectionState.Connected})),_defineProperty__default.default(this,"disconnect",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,a,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:2e3,removeConnectionEventListeners(n._onlineStatusChanged),n._setState(ConnectionState.Disconnected),null===(t=n.cancelToken)||void 0===t||t.cancel("disconnect() is called"),n.cancelToken=void 0,a=n.connectionID,n.connectionID=void 0,e.prev=7,e.next=10,n._req({close:!0,connection_id:a},{timeout:r},!1);case 10:n._log("disconnect() - Closed connectionID"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(7),n._log("disconnect() - Failed",{err:e.t0},"error");case 16:case"end":return e.stop()}}),e,null,[[7,13]])})))),this.client=r,this.state=ConnectionState.Init,this.consecutiveFailures=0,addConnectionEventListeners(this._onlineStatusChanged)}return _createClass__default.default(e,[{key:"_log",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(n,"WSConnectionFallback:"+e,_objectSpread$5({tags:["connection_fallback","connection"]},t))}},{key:"_setState",value:function(e){this._log("_setState() - ".concat(e)),this.state===ConnectionState.Connecting&&e===ConnectionState.Connected&&this.client.dispatchEvent({type:"connection.changed",online:!0}),e!==ConnectionState.Closed&&e!==ConnectionState.Disconnected||this.client.dispatchEvent({type:"connection.changed",online:!1}),this.state=e}}]),e}(),Campaign=function(){function e(t,n,r){_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"id",void 0),_defineProperty__default.default(this,"data",void 0),_defineProperty__default.default(this,"client",void 0),this.client=t,this.id=n,this.data=r}var t,n,r,a,s,i;return _createClass__default.default(e,[{key:"create",value:(i=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a,s,i,o,u,l,c;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l={id:this.id,message_template:null===(t=this.data)||void 0===t?void 0:t.message_template,segment_ids:null===(n=this.data)||void 0===n?void 0:n.segment_ids,sender_id:null===(r=this.data)||void 0===r?void 0:r.sender_id,channel_template:null===(a=this.data)||void 0===a?void 0:a.channel_template,create_channels:null===(s=this.data)||void 0===s?void 0:s.create_channels,description:null===(i=this.data)||void 0===i?void 0:i.description,name:null===(o=this.data)||void 0===o?void 0:o.name,user_ids:null===(u=this.data)||void 0===u?void 0:u.user_ids},e.next=3,this.client.createCampaign(l);case 3:return c=e.sent,this.id=c.campaign.id,this.data=c.campaign,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"verifyCampaignId",value:function(){if(!this.id)throw new Error("Campaign id is missing. Either create the campaign using campaign.create() or set the id during instantiation - const campaign = client.campaign(id)")}},{key:"start",value:(s=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.startCampaign(this.id,t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"update",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.updateCampaign(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"delete",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.next=3,this.client.deleteCampaign(this.id);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"stop",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.stopCampaign(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"get",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifyCampaignId(),e.abrupt("return",this.client.getCampaign(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Segment=function(){function e(t,n,r,a){_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"type",void 0),_defineProperty__default.default(this,"id",void 0),_defineProperty__default.default(this,"client",void 0),_defineProperty__default.default(this,"data",void 0),this.client=t,this.type=n,this.id=r,this.data=a}var t,n,r,a,s,i,o,u;return _createClass__default.default(e,[{key:"create",value:(u=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a,s,i;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={name:null===(t=this.data)||void 0===t?void 0:t.name,filter:null===(n=this.data)||void 0===n?void 0:n.filter,description:null===(r=this.data)||void 0===r?void 0:r.description,all_sender_channels:null===(a=this.data)||void 0===a?void 0:a.all_sender_channels,all_users:null===(s=this.data)||void 0===s?void 0:s.all_users},e.abrupt("return",this.client.createSegment(this.type,this.id,i));case 2:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"verifySegmentId",value:function(){if(!this.id)throw new Error("Segment id is missing. Either create the segment using segment.create() or set the id during instantiation - const segment = client.segment(id)")}},{key:"get",value:(o=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.getSegment(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"update",value:(i=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.updateSegment(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"addTargets",value:(s=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.addSegmentTargets(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"removeTargets",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.removeSegmentTargets(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"delete",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.deleteSegment(this.id));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"targetExists",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.verifySegmentId(),e.abrupt("return",this.client.segmentTargetExists(this.id,t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"queryTargets",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},this.verifySegmentId(),e.abrupt("return",this.client.querySegmentTargets(this.id,t,n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf__default.default(e);if(t){var a=_getPrototypeOf__default.default(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return _possibleConstructorReturn__default.default(this,n)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}var ErrorFromResponse=function(e){_inherits__default.default(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck__default.default(this,n);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),_defineProperty__default.default(_assertThisInitialized__default.default(e),"code",void 0),_defineProperty__default.default(_assertThisInitialized__default.default(e),"response",void 0),_defineProperty__default.default(_assertThisInitialized__default.default(e),"status",void 0),e}return n}(_wrapNativeSuper__default.default(Error));function ownKeys$4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$4(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$4(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function isPatch(e){return"function"==typeof e}exports.VotingVisibility=void 0,function(e){e.anonymous="anonymous",e.public="public"}(exports.VotingVisibility||(exports.VotingVisibility={}));var StateStore=function e(t){var n=this;_classCallCheck__default.default(this,e),this.value=t,_defineProperty__default.default(this,"handlerSet",new Set),_defineProperty__default.default(this,"next",(function(e){var t=isPatch(e)?e(n.value):e;if(t!==n.value){var r=n.value;n.value=t,n.handlerSet.forEach((function(e){return e(n.value,r)}))}})),_defineProperty__default.default(this,"partialNext",(function(e){return n.next((function(t){return _objectSpread$4(_objectSpread$4({},t),e)}))})),_defineProperty__default.default(this,"getLatestValue",(function(){return n.value})),_defineProperty__default.default(this,"subscribe",(function(e){return e(n.value,void 0),n.handlerSet.add(e),function(){n.handlerSet.delete(e)}})),_defineProperty__default.default(this,"subscribeWithSelector",(function(e,t){var r;return n.subscribe((function(n){var a,s,i=e(n),o=null===(a=null===(s=r)||void 0===s?void 0:s.some((function(e,t){return e!==i[t]})))||void 0===a||a;if(o){var u=r;r=i,t(i,u)}}))}))},_excluded$1=["limit","sort"];function ownKeys$3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$3(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$3(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var DEFAULT_PAGE_LIMIT=50,DEFAULT_SORT=[{created_at:-1}],MARK_AS_READ_THROTTLE_TIMEOUT=1e3,Thread=function(){function e(t){var n,r,a=this,s=t.client,i=t.threadData;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"state",void 0),_defineProperty__default.default(this,"id",void 0),_defineProperty__default.default(this,"client",void 0),_defineProperty__default.default(this,"unsubscribeFunctions",new Set),_defineProperty__default.default(this,"failedRepliesMap",new Map),_defineProperty__default.default(this,"activate",(function(){a.state.partialNext({active:!0})})),_defineProperty__default.default(this,"deactivate",(function(){a.state.partialNext({active:!1})})),_defineProperty__default.default(this,"reload",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.state.getLatestValue().isLoading){e.next=2;break}return e.abrupt("return");case 2:return a.state.partialNext({isLoading:!0}),e.prev=3,e.next=6,a.client.getThread(a.id,{watch:!0});case 6:t=e.sent,a.hydrateState(t);case 8:return e.prev=8,a.state.partialNext({isLoading:!1}),e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[3,,8,11]])})))),_defineProperty__default.default(this,"hydrateState",(function(e){if(e!==a){if(e.id!==a.id)throw new Error("Cannot hydrate thread state with using thread's state");var t=e.state.getLatestValue(),n=t.read,r=t.replyCount,s=t.replies,i=t.parentMessage,o=t.participants,u=t.createdAt,l=t.deletedAt,c=t.updatedAt,d=Array.from(a.failedRepliesMap.values());a.state.partialNext({read:n,replyCount:r,replies:d.length?s.concat(d):s,parentMessage:i,participants:o,createdAt:u,deletedAt:l,updatedAt:c,isStateStale:!1})}})),_defineProperty__default.default(this,"registerSubscriptions",(function(){a.unsubscribeFunctions.size||(a.unsubscribeFunctions.add(a.subscribeMarkActiveThreadRead()),a.unsubscribeFunctions.add(a.subscribeReloadActiveStaleThread()),a.unsubscribeFunctions.add(a.subscribeMarkThreadStale()),a.unsubscribeFunctions.add(a.subscribeNewReplies()),a.unsubscribeFunctions.add(a.subscribeRepliesRead()),a.unsubscribeFunctions.add(a.subscribeMessageDeleted()),a.unsubscribeFunctions.add(a.subscribeMessageUpdated()))})),_defineProperty__default.default(this,"subscribeMarkActiveThreadRead",(function(){return a.state.subscribeWithSelector((function(e){return[e.active,ownUnreadCountSelector(a.client.userID)(e)]}),(function(e){var t=_slicedToArray__default.default(e,2),n=t[0],r=t[1];n&&r&&a.throttledMarkAsRead()}))})),_defineProperty__default.default(this,"subscribeReloadActiveStaleThread",(function(){return a.state.subscribeWithSelector((function(e){return[e.active,e.isStateStale]}),(function(e){var t=_slicedToArray__default.default(e,2),n=t[0],r=t[1];n&&r&&a.reload()}))})),_defineProperty__default.default(this,"subscribeMarkThreadStale",(function(){return a.client.on("user.watching.stop",(function(e){var t,n,r=a.state.getLatestValue().channel;a.client.userID&&a.client.userID===(null===(t=e.user)||void 0===t?void 0:t.id)&&(null===(n=e.channel)||void 0===n?void 0:n.cid)===r.cid&&a.state.partialNext({isStateStale:!0})})).unsubscribe})),_defineProperty__default.default(this,"subscribeNewReplies",(function(){return a.client.on("message.new",(function(e){var t,n;if(a.client.userID&&(null===(t=e.message)||void 0===t?void 0:t.parent_id)===a.id){var r=(null===(n=e.message.user)||void 0===n?void 0:n.id)===a.client.userID,s=a.state.getLatestValue(),i=s.active,o=s.read;a.upsertReplyLocally({message:e.message,timestampChanged:r}),i&&a.throttledMarkAsRead();for(var u={},l=0,c=Object.keys(o);l<c.length;l++){var d=c[l],f=o[d];if(f){var _,p=f;d===(null===(_=e.user)||void 0===_?void 0:_.id)?p=_objectSpread$3(_objectSpread$3({},p),{},{lastReadAt:e.created_at?new Date(e.created_at):new Date,user:e.user,unreadMessageCount:0}):i&&d===a.client.userID||(p=_objectSpread$3(_objectSpread$3({},p),{},{unreadMessageCount:f.unreadMessageCount+1})),u[d]=p}}a.state.partialNext({read:u})}})).unsubscribe})),_defineProperty__default.default(this,"subscribeRepliesRead",(function(){return a.client.on("message.read",(function(e){if(e.user&&e.created_at&&e.thread&&e.thread.parent_message_id===a.id){var t=e.user.id,n=e.created_at,r=e.user;a.state.next((function(a){return _objectSpread$3(_objectSpread$3({},a),{},{read:_objectSpread$3(_objectSpread$3({},a.read),{},_defineProperty__default.default({},t,{lastReadAt:new Date(n),user:r,lastReadMessageId:e.last_read_message_id,unreadMessageCount:0}))})}))}})).unsubscribe})),_defineProperty__default.default(this,"subscribeMessageDeleted",(function(){return a.client.on("message.deleted",(function(e){e.message&&(e.message.parent_id===a.id&&(e.hard_delete?a.deleteReplyLocally({message:e.message}):a.upsertReplyLocally({message:e.message})),e.message.id===a.id&&a.updateParentMessageLocally({message:e.message}))})).unsubscribe})),_defineProperty__default.default(this,"subscribeMessageUpdated",(function(){var e=["message.updated","reaction.new","reaction.deleted","reaction.updated"].map((function(e){return a.client.on(e,(function(e){e.message&&a.updateParentMessageOrReplyLocally(e.message)})).unsubscribe}));return function(){return e.forEach((function(e){return e()}))}})),_defineProperty__default.default(this,"unregisterSubscriptions",(function(){a.unsubscribeFunctions.forEach((function(e){return e()})),a.unsubscribeFunctions.clear()})),_defineProperty__default.default(this,"deleteReplyLocally",(function(e){var t,n,r=e.message,s=a.state.getLatestValue().replies,i=findIndexInSortedArray({needle:formatMessage(r),sortedArray:s,sortDirection:"ascending",selectValueToCompare:function(e){return e.created_at.getTime()}}),o=(null===(t=s[i])||void 0===t?void 0:t.id)===r.id?i:(null===(n=s[i-1])||void 0===n?void 0:n.id)===r.id?i-1:null;if(null!==o){var u=_toConsumableArray__default.default(s);u.splice(o,1),a.state.partialNext({replies:u})}})),_defineProperty__default.default(this,"upsertReplyLocally",(function(e){var t=e.message,n=e.timestampChanged,r=void 0!==n&&n;if(t.parent_id!==a.id)throw new Error("Reply does not belong to this thread");var s=formatMessage(t);"failed"===t.status?a.failedRepliesMap.set(s.id,s):a.failedRepliesMap.has(t.id)&&a.failedRepliesMap.delete(t.id),a.state.next((function(e){return _objectSpread$3(_objectSpread$3({},e),{},{replies:addToMessageList(e.replies,s,r)})}))})),_defineProperty__default.default(this,"updateParentMessageLocally",(function(e){var t=e.message;if(t.id!==a.id)throw new Error("Message does not belong to this thread");a.state.next((function(e){var n,r=formatMessage(t);return _objectSpread$3(_objectSpread$3({},e),{},{deletedAt:r.deleted_at,parentMessage:r,replyCount:null!==(n=t.reply_count)&&void 0!==n?n:e.replyCount})}))})),_defineProperty__default.default(this,"updateParentMessageOrReplyLocally",(function(e){e.parent_id===a.id&&a.upsertReplyLocally({message:e}),e.parent_id||e.id!==a.id||a.updateParentMessageLocally({message:e})})),_defineProperty__default.default(this,"markAsRead",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(r.length>0&&void 0!==r[0]?r[0]:{}).force,n=void 0!==t&&t,0!==a.ownUnreadCount||n){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,a.channel.markRead({thread_id:a.id});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))),_defineProperty__default.default(this,"throttledMarkAsRead",throttle((function(){return a.markAsRead()}),MARK_AS_READ_THROTTLE_TIMEOUT,{trailing:!0})),_defineProperty__default.default(this,"queryReplies",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.limit,n=void 0===t?DEFAULT_PAGE_LIMIT:t,r=e.sort,s=void 0===r?DEFAULT_SORT:r,i=_objectWithoutProperties__default.default(e,_excluded$1);return a.channel.getReplies(a.id,_objectSpread$3({limit:n},i),s)})),_defineProperty__default.default(this,"loadNextPage",(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).limit,t=void 0===e?DEFAULT_PAGE_LIMIT:e;return a.loadPage(t)})),_defineProperty__default.default(this,"loadPrevPage",(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).limit,t=void 0===e?DEFAULT_PAGE_LIMIT:e;return a.loadPage(-t)})),_defineProperty__default.default(this,"loadPage",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,s,i,o,u,l,c,d,f,_,p,h,g;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.state.getLatestValue(),r=n.pagination,s=t>0?["isLoadingNext","nextCursor","push"]:["isLoadingPrev","prevCursor","unshift"],i=_slicedToArray__default.default(s,3),o=i[0],u=i[1],l=i[2],!r[o]&&null!==r[u]){e.next=4;break}return e.abrupt("return");case 4:return c=_defineProperty__default.default({},t>0?"id_gt":"id_lt",r[u]),d=Math.abs(t),a.state.partialNext({pagination:_objectSpread$3(_objectSpread$3({},r),{},_defineProperty__default.default({},o,!0))}),e.prev=7,e.next=10,a.queryReplies(_objectSpread$3(_objectSpread$3({},c),{},{limit:d}));case 10:p=e.sent,h=p.messages.map(formatMessage),g=null!==(f=null===(_=h.at(t>0?-1:0))||void 0===_?void 0:_.id)&&void 0!==f?f:null,a.state.next((function(e){var t,n,r=e.replies;h.length>0&&(n=r=_toConsumableArray__default.default(e.replies))[l].apply(n,_toConsumableArray__default.default(h));return _objectSpread$3(_objectSpread$3({},e),{},{replies:r,pagination:_objectSpread$3(_objectSpread$3({},e.pagination),{},(t={},_defineProperty__default.default(t,u,p.messages.length<d?null:g),_defineProperty__default.default(t,o,!1),t))})})),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),a.client.logger("error",e.t0.message),a.state.next((function(e){return _objectSpread$3(_objectSpread$3({},e),{},{pagination:_objectSpread$3(_objectSpread$3({},e.pagination),{},_defineProperty__default.default({},o,!1))})}));case 20:case"end":return e.stop()}}),e,null,[[7,16]])})));return function(t){return e.apply(this,arguments)}}());var o=s.channel(i.channel.type,i.channel.id,{name:i.channel.name});o._hydrateMembers(null!==(n=i.channel.members)&&void 0!==n?n:[]);var u=s.userID?[{user:{id:s.userID},unread_messages:0,last_read:(new Date).toISOString()}]:[];this.state=new StateStore({active:!1,channel:o,createdAt:new Date(i.created_at),deletedAt:i.deleted_at?new Date(i.deleted_at):null,isLoading:!1,isStateStale:!1,pagination:repliesPaginationFromInitialThread(i),parentMessage:formatMessage(i.parent_message),participants:i.thread_participants,read:formatReadState(i.read&&0!==i.read.length?i.read:u),replies:i.latest_replies.map(formatMessage),replyCount:null!==(r=i.reply_count)&&void 0!==r?r:0,updatedAt:i.updated_at?new Date(i.updated_at):null}),this.id=i.parent_message_id,this.client=s}return _createClass__default.default(e,[{key:"channel",get:function(){return this.state.getLatestValue().channel}},{key:"hasStaleState",get:function(){return this.state.getLatestValue().isStateStale}},{key:"ownUnreadCount",get:function(){return ownUnreadCountSelector(this.client.userID)(this.state.getLatestValue())}}]),e}(),formatReadState=function(e){return e.reduce((function(e,t){var n;return e[t.user.id]={user:t.user,lastReadMessageId:t.last_read_message_id,unreadMessageCount:null!==(n=t.unread_messages)&&void 0!==n?n:0,lastReadAt:new Date(t.last_read)},e}),{})},repliesPaginationFromInitialThread=function(e){var t,n;return{nextCursor:null,prevCursor:e.latest_replies.length===e.reply_count?null:null!==(t=null===(n=e.latest_replies.at(0))||void 0===n?void 0:n.id)&&void 0!==t?t:null,isLoadingNext:!1,isLoadingPrev:!1}},ownUnreadCountSelector=function(e){return function(t){var n;return e&&(null===(n=t.read[e])||void 0===n?void 0:n.unreadMessageCount)||0}};function ownKeys$2(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$2(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$2(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var MODERATION_ENTITY_TYPES={user:"stream:user",message:"stream:chat:v1:message"},Moderation=function(){function e(t){_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"client",void 0),this.client=t}var t,n,r,a,s,i,o,u,l,c;return _createClass__default.default(e,[{key:"flagUser",value:(c=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.flag(MODERATION_ENTITY_TYPES.user,t,"",n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"flagMessage",value:(l=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.flag(MODERATION_ENTITY_TYPES.message,t,"",n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"flag",value:(u=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r,a){var s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=i.length>4&&void 0!==i[4]?i[4]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/flag",_objectSpread$2({entity_type:t,entity_id:n,entity_creator_id:r,reason:a},s));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return u.apply(this,arguments)})},{key:"muteUser",value:(o=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/mute",_objectSpread$2({target_ids:[t]},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"unmuteUser",value:(i=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post(this.client.baseURL+"/api/v2/moderation/unmute",_objectSpread$2({target_ids:[t]},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getUserModerationReport",value:(s=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.client.get(this.client.baseURL+"/api/v2/moderation/user_report",_objectSpread$2({user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"queryReviewQueue",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=5,this.client.post(this.client.baseURL+"/api/v2/moderation/review_queue",_objectSpread$2({filter:t,sort:normalizeQuerySort(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"upsertConfig",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/config",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getConfig",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.get(this.client.baseURL+"/api/v2/moderation/config/"+t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"submitAction",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this.client.post(this.client.baseURL+"/api/v2/moderation/submit_action",_objectSpread$2({action_type:t,item_id:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();function _createForOfIteratorHelper$1(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray$1(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function _unsupportedIterableToArray$1(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray$1(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray$1(e,t):void 0}}function _arrayLikeToArray$1(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys$1(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread$1(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys$1(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys$1(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var DEFAULT_CONNECTION_RECOVERY_THROTTLE_DURATION=1e3,MAX_QUERY_THREADS_LIMIT=25,ThreadManager=function(){function e(t){var n=this,r=t.client;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"state",void 0),_defineProperty__default.default(this,"client",void 0),_defineProperty__default.default(this,"unsubscribeFunctions",new Set),_defineProperty__default.default(this,"threadsByIdGetterCache",void 0),_defineProperty__default.default(this,"activate",(function(){n.state.partialNext({active:!0})})),_defineProperty__default.default(this,"deactivate",(function(){n.state.partialNext({active:!1})})),_defineProperty__default.default(this,"registerSubscriptions",(function(){n.unsubscribeFunctions.size||(n.unsubscribeFunctions.add(n.subscribeUnreadThreadsCountChange()),n.unsubscribeFunctions.add(n.subscribeManageThreadSubscriptions()),n.unsubscribeFunctions.add(n.subscribeReloadOnActivation()),n.unsubscribeFunctions.add(n.subscribeNewReplies()),n.unsubscribeFunctions.add(n.subscribeRecoverAfterConnectionDrop()))})),_defineProperty__default.default(this,"subscribeUnreadThreadsCountChange",(function(){var e,t=(null!==(e=n.client.user)&&void 0!==e?e:{}).unread_threads,r=void 0===t?0:t;n.state.partialNext({unreadThreadCount:r});var a=["health.check","notification.mark_read","notification.thread_message_new","notification.channel_deleted"].map((function(e){return n.client.on(e,(function(e){var t,r=(null!==(t=e.me)&&void 0!==t?t:e).unread_threads;"number"==typeof r&&n.state.partialNext({unreadThreadCount:r})})).unsubscribe}));return function(){return a.forEach((function(e){return e()}))}})),_defineProperty__default.default(this,"subscribeManageThreadSubscriptions",(function(){return n.state.subscribeWithSelector((function(e){return[e.threads]}),(function(e,t){var r=_slicedToArray__default.default(e,1)[0],a=null!=t?t:[],s=_slicedToArray__default.default(a,1)[0],i=(void 0===s?[]:s).filter((function(e){return e!==n.threadsById[e.id]}));r.forEach((function(e){return e.registerSubscriptions()})),i.forEach((function(e){return e.unregisterSubscriptions()}))}))})),_defineProperty__default.default(this,"subscribeReloadOnActivation",(function(){return n.state.subscribeWithSelector((function(e){return[e.active]}),(function(e){_slicedToArray__default.default(e,1)[0]&&n.reload()}))})),_defineProperty__default.default(this,"subscribeNewReplies",(function(){return n.client.on("notification.thread_message_new",(function(e){var t,r=null===(t=e.message)||void 0===t?void 0:t.parent_id;if(r){var a=n.state.getLatestValue(),s=a.unseenThreadIds;a.ready&&(n.threadsById[r]?n.state.partialNext({isThreadOrderStale:!0}):s.includes(r)||n.state.partialNext({unseenThreadIds:s.concat(r)}))}})).unsubscribe})),_defineProperty__default.default(this,"subscribeRecoverAfterConnectionDrop",(function(){var e=n.client.on("connection.changed",(function(e){!1===e.online&&n.state.next((function(e){return e.lastConnectionDropAt?e:_objectSpread$1(_objectSpread$1({},e),{},{lastConnectionDropAt:new Date})}))})).unsubscribe,t=throttle((function(){n.state.getLatestValue().lastConnectionDropAt&&n.reload({force:!0})}),DEFAULT_CONNECTION_RECOVERY_THROTTLE_DURATION,{trailing:!0}),r=n.client.on("connection.recovered",t).unsubscribe;return function(){e(),r()}})),_defineProperty__default.default(this,"unregisterSubscriptions",(function(){n.state.getLatestValue().threads.forEach((function(e){return e.unregisterSubscriptions()})),n.unsubscribeFunctions.forEach((function(e){return e()})),n.unsubscribeFunctions.clear()})),_defineProperty__default.default(this,"reload",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,a,s,i,o,u,l,c,d,f,_,p,h,g,v,m=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(m.length>0&&void 0!==m[0]?m[0]:{}).force,r=void 0!==t&&t,a=n.state.getLatestValue(),s=a.threads,i=a.unseenThreadIds,o=a.isThreadOrderStale,u=a.pagination,l=a.ready,!u.isLoading){e.next=4;break}return e.abrupt("return");case 4:if(r||!l||i.length||o){e.next=6;break}return e.abrupt("return");case 6:return c=s.length+i.length,e.prev=7,n.state.next((function(e){return _objectSpread$1(_objectSpread$1({},e),{},{pagination:_objectSpread$1(_objectSpread$1({},e.pagination),{},{isLoading:!0})})})),e.next=11,n.queryThreads({limit:Math.min(c,MAX_QUERY_THREADS_LIMIT)||MAX_QUERY_THREADS_LIMIT});case 11:d=e.sent,f=n.threadsById,_=[],p=_createForOfIteratorHelper$1(d.threads);try{for(p.s();!(h=p.n()).done;)g=h.value,(v=f[g.id])?(_.push(v),v.hasStaleState&&v.hydrateState(g)):_.push(g)}catch(e){p.e(e)}finally{p.f()}n.state.next((function(e){var t;return _objectSpread$1(_objectSpread$1({},e),{},{threads:_,unseenThreadIds:[],isThreadOrderStale:!1,pagination:_objectSpread$1(_objectSpread$1({},e.pagination),{},{isLoading:!1,nextCursor:null!==(t=d.next)&&void 0!==t?t:null}),ready:!0})})),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(7),n.client.logger("error",e.t0.message),n.state.next((function(e){return _objectSpread$1(_objectSpread$1({},e),{},{pagination:_objectSpread$1(_objectSpread$1({},e.pagination),{},{isLoading:!1})})}));case 23:case"end":return e.stop()}}),e,null,[[7,19]])})))),_defineProperty__default.default(this,"queryThreads",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return n.client.queryThreads(_objectSpread$1({limit:25,participant_limit:10,reply_limit:10,watch:!0},e))})),_defineProperty__default.default(this,"loadNextPage",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,r,a,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},r=n.state.getLatestValue(),!(a=r.pagination).isLoadingNext&&a.nextCursor){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,n.state.partialNext({pagination:_objectSpread$1(_objectSpread$1({},a),{},{isLoadingNext:!0})}),e.next=8,n.queryThreads(_objectSpread$1(_objectSpread$1({},t),{},{next:a.nextCursor}));case 8:s=e.sent,n.state.next((function(e){var t;return _objectSpread$1(_objectSpread$1({},e),{},{threads:s.threads.length?e.threads.concat(s.threads):e.threads,pagination:_objectSpread$1(_objectSpread$1({},e.pagination),{},{nextCursor:null!==(t=s.next)&&void 0!==t?t:null,isLoadingNext:!1})})})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),n.client.logger("error",e.t0.message),n.state.next((function(e){return _objectSpread$1(_objectSpread$1({},e),{},{pagination:_objectSpread$1(_objectSpread$1({},e.pagination),{},{isLoadingNext:!1})})}));case 16:case"end":return e.stop()}}),e,null,[[4,12]])})))),this.client=r,this.state=new StateStore({active:!1,isThreadOrderStale:!1,threads:[],unreadThreadCount:0,unseenThreadIds:[],lastConnectionDropAt:null,pagination:{isLoading:!1,isLoadingNext:!1,nextCursor:null},ready:!1}),this.threadsByIdGetterCache={threads:[],threadsById:{}}}return _createClass__default.default(e,[{key:"threadsById",get:function(){var e=this.state.getLatestValue().threads;if(e===this.threadsByIdGetterCache.threads)return this.threadsByIdGetterCache.threadsById;var t=e.reduce((function(e,t){return e[t.id]=t,e}),{});return this.threadsByIdGetterCache.threads=e,this.threadsByIdGetterCache.threadsById=t,t}}]),e}(),_excluded=["created_at","updated_at","last_active","online"],_excluded2=["params","headers"];function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty__default.default(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function isString(e){return"string"==typeof e||e instanceof String}var StreamChat=function(){function e(t,n,r){var a,s=this;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"_user",void 0),_defineProperty__default.default(this,"activeChannels",void 0),_defineProperty__default.default(this,"threads",void 0),_defineProperty__default.default(this,"anonymous",void 0),_defineProperty__default.default(this,"persistUserOnConnectionFailure",void 0),_defineProperty__default.default(this,"axiosInstance",void 0),_defineProperty__default.default(this,"baseURL",void 0),_defineProperty__default.default(this,"browser",void 0),_defineProperty__default.default(this,"cleaningIntervalRef",void 0),_defineProperty__default.default(this,"clientID",void 0),_defineProperty__default.default(this,"configs",void 0),_defineProperty__default.default(this,"key",void 0),_defineProperty__default.default(this,"listeners",void 0),_defineProperty__default.default(this,"logger",void 0),_defineProperty__default.default(this,"recoverStateOnReconnect",void 0),_defineProperty__default.default(this,"moderation",void 0),_defineProperty__default.default(this,"mutedChannels",void 0),_defineProperty__default.default(this,"mutedUsers",void 0),_defineProperty__default.default(this,"node",void 0),_defineProperty__default.default(this,"options",void 0),_defineProperty__default.default(this,"secret",void 0),_defineProperty__default.default(this,"setUserPromise",void 0),_defineProperty__default.default(this,"state",void 0),_defineProperty__default.default(this,"tokenManager",void 0),_defineProperty__default.default(this,"user",void 0),_defineProperty__default.default(this,"userAgent",void 0),_defineProperty__default.default(this,"userID",void 0),_defineProperty__default.default(this,"wsBaseURL",void 0),_defineProperty__default.default(this,"wsConnection",void 0),_defineProperty__default.default(this,"wsFallback",void 0),_defineProperty__default.default(this,"wsPromise",void 0),_defineProperty__default.default(this,"consecutiveFailures",void 0),_defineProperty__default.default(this,"insightMetrics",void 0),_defineProperty__default.default(this,"defaultWSTimeoutWithFallback",void 0),_defineProperty__default.default(this,"defaultWSTimeout",void 0),_defineProperty__default.default(this,"nextRequestAbortController",null),_defineProperty__default.default(this,"_getConnectionID",(function(){var e,t;return(null===(e=s.wsConnection)||void 0===e?void 0:e.connectionID)||(null===(t=s.wsFallback)||void 0===t?void 0:t.connectionID)})),_defineProperty__default.default(this,"_hasConnectionID",(function(){return Boolean(s._getConnectionID())})),_defineProperty__default.default(this,"connectUser",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw new Error('The "id" field on the user is missing');case 2:if(s.userID!==t.id||!s.setUserPromise){e.next=5;break}return console.warn("Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),e.abrupt("return",s.setUserPromise);case 5:if(!s.userID){e.next=7;break}throw new Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");case 7:return!s._isUsingServerAuth()&&!s.node||s.options.allowServerSideConnect||console.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),s.userID=t.id,s.anonymous=!1,r=s._setToken(t,n),s._setUser(t),a=s.openConnection(),s.setUserPromise=Promise.all([r,a]).then((function(e){return e[1]})),e.prev=14,e.next=17,s.setUserPromise;case 17:return e.abrupt("return",e.sent);case 20:throw e.prev=20,e.t0=e.catch(14),s.persistUserOnConnectionFailure?s.closeConnection():s.disconnectUser(),e.t0;case 24:case"end":return e.stop()}}),e,null,[[14,20]])})));return function(t,n){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"setUser",this.connectUser),_defineProperty__default.default(this,"_setToken",(function(e,t){return s.tokenManager.setTokenOrProvider(t,e)})),_defineProperty__default.default(this,"closeConnection",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=s.cleaningIntervalRef&&(clearInterval(s.cleaningIntervalRef),s.cleaningIntervalRef=void 0),e.next=3,Promise.all([null===(n=s.wsConnection)||void 0===n?void 0:n.disconnect(t),null===(r=s.wsFallback)||void 0===r?void 0:r.disconnect(t)]);case 3:return e.abrupt("return",Promise.resolve());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"openConnection",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.userID){e.next=2;break}throw Error("User is not set on client, use client.connectUser or client.connectAnonymousUser instead");case 2:if(null===(t=s.wsConnection)||void 0===t||!t.isConnecting||!s.wsPromise){e.next=5;break}return s.logger("info","client:openConnection() - connection already in progress",{tags:["connection","client"]}),e.abrupt("return",s.wsPromise);case 5:if(!(null!==(n=s.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=s.wsFallback)&&void 0!==r&&r.isHealthy())||!s._hasConnectionID()){e.next=8;break}return s.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists",{tags:["connection","client"]}),e.abrupt("return");case 8:return s.clientID="".concat(s.userID,"--").concat(randomId()),s.wsPromise=s.connect(),s._startCleaning(),e.abrupt("return",s.wsPromise);case 12:case"end":return e.stop()}}),e)})))),_defineProperty__default.default(this,"_setupConnection",this.openConnection),_defineProperty__default.default(this,"_normalizeDate",(function(e){if(e instanceof Date&&(e=e.toISOString()),""===e)throw new Error("Don't pass blank string for since, use null instead if resetting the token revoke");return e})),_defineProperty__default.default(this,"disconnectUser",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s.logger("info","client:disconnect() - Disconnecting the client",{tags:["connection","client"]}),delete s.user,delete s._user,delete s.userID,s.anonymous=!1,n=s.closeConnection(t),r=0,a=Object.values(s.activeChannels);r<a.length;r++)a[r]._disconnect();return s.activeChannels={},s.state=new ClientState,setTimeout(s.tokenManager.reset),e.abrupt("return",n);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"disconnect",this.disconnectUser),_defineProperty__default.default(this,"connectAnonymousUser",(function(){!s._isUsingServerAuth()&&!s.node||s.options.allowServerSideConnect||console.warn('Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),s.anonymous=!0,s.userID=randomId();var e={id:s.userID,anon:!0};return s._setToken(e,""),s._setUser(e),s._setupConnection()})),_defineProperty__default.default(this,"setAnonymousUser",this.connectAnonymousUser),_defineProperty__default.default(this,"doAxiosRequest",function(){var e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){var a,i,o,u,l=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>3&&void 0!==l[3]?l[3]:{},e.next=3,s.tokenManager.tokenReady();case 3:i=s._enrichAxiosOptions(a),e.prev=4,s._logApiRequest(t,n,r,i),e.t0=t,e.next="get"===e.t0?9:"delete"===e.t0?13:"post"===e.t0?17:"postForm"===e.t0?21:"put"===e.t0?25:"patch"===e.t0?29:"options"===e.t0?33:37;break;case 9:return e.next=11,s.axiosInstance.get(n,i);case 11:case 15:case 19:case 23:case 27:case 31:case 35:return o=e.sent,e.abrupt("break",38);case 13:return e.next=15,s.axiosInstance.delete(n,i);case 17:return e.next=19,s.axiosInstance.post(n,r,i);case 21:return e.next=23,s.axiosInstance.postForm(n,r,i);case 25:return e.next=27,s.axiosInstance.put(n,r,i);case 29:return e.next=31,s.axiosInstance.patch(n,r,i);case 33:return e.next=35,s.axiosInstance.options(n,i);case 37:throw new Error("Invalid request type");case 38:return s._logApiResponse(t,n,o),s.consecutiveFailures=0,e.abrupt("return",s.handleResponse(o));case 43:if(e.prev=43,e.t1=e.catch(4),e.t1.client_request_id=null===(u=i.headers)||void 0===u?void 0:u["x-client-request-id"],s._logApiError(t,n,e.t1),s.consecutiveFailures+=1,!e.t1.response){e.next=60;break}if(e.t1.response.data.code!==chatCodes.TOKEN_EXPIRED||s.tokenManager.isStatic()){e.next=57;break}if(!(s.consecutiveFailures>1)){e.next=53;break}return e.next=53,sleep(retryInterval(s.consecutiveFailures));case 53:return s.tokenManager.loadToken(),e.next=56,s.doAxiosRequest(t,n,r,a);case 56:return e.abrupt("return",e.sent);case 57:return e.abrupt("return",s.handleResponse(e.t1.response));case 60:throw e.t1;case 61:case"end":return e.stop()}}),e,null,[[4,43]])})));return function(t,n,r){return e.apply(this,arguments)}}()),_defineProperty__default.default(this,"dispatchEvent",(function(e){e.received_at||(e.received_at=new Date);var t=s._handleClientEvent(e),n=e.cid,r=n?s.activeChannels[n]:void 0;r&&r._handleChannelEvent(e),s._callClientListeners(e),r&&r._callChannelListeners(e),t.forEach((function(e){return e()}))})),_defineProperty__default.default(this,"handleEvent",(function(e){var t=e.data,n=JSON.parse(t);s.dispatchEvent(n)})),_defineProperty__default.default(this,"_updateMemberWatcherReferences",(function(e){var t=s.state.userChannelReferences[e.id]||{};for(var n in t){var r=s.activeChannels[n];null!=r&&r.state&&(r.state.members[e.id]&&(r.state.members[e.id].user=e),r.state.watchers[e.id]&&(r.state.watchers[e.id]=e),r.state.read[e.id]&&(r.state.read[e.id].user=e))}})),_defineProperty__default.default(this,"_updateUserReferences",this._updateMemberWatcherReferences),_defineProperty__default.default(this,"_updateUserMessageReferences",(function(e){var t=s.state.userChannelReferences[e.id]||{};for(var n in t){var r=s.activeChannels[n];if(r){var a=r.state;null==a||a.updateUserMessages(e)}}})),_defineProperty__default.default(this,"_deleteUserMessageReference",(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=s.state.userChannelReferences[e.id]||{};for(var r in n){var a=s.activeChannels[r].state;null==a||a.deleteUserMessages(e,t)}})),_defineProperty__default.default(this,"_handleUserEvent",(function(e){if(e.user){if("user.presence.changed"===e.type||"user.updated"===e.type){if(e.user.id===s.userID){var t=_objectSpread({},s.user||{}),n=_objectSpread({},s._user||{});for(var r in s.user)r in e.user||isOwnUserBaseProperty(r)||(delete t[r],delete n[r]);for(var a in e.user)n&&a in n&&(n[a]=e.user[a]);s._user=_objectSpread({},n),s.user=_objectSpread(_objectSpread({},t),e.user)}s.state.updateUser(e.user),s._updateMemberWatcherReferences(e.user)}"user.updated"===e.type&&s._updateUserMessageReferences(e.user),"user.deleted"===e.type&&e.user.deleted_at&&(e.mark_messages_deleted||e.hard_delete)&&s._deleteUserMessageReference(e.user,e.hard_delete)}})),_defineProperty__default.default(this,"_callClientListeners",(function(e){var t=s,n=[];t.listeners.all&&n.push.apply(n,_toConsumableArray__default.default(t.listeners.all)),t.listeners[e.type]&&n.push.apply(n,_toConsumableArray__default.default(t.listeners[e.type]));for(var r=0,a=n;r<a.length;r++){(0,a[r])(e)}})),_defineProperty__default.default(this,"recoverState",_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.logger("info","client:recoverState() - Start of recoverState with connectionID ".concat(s._getConnectionID()),{tags:["connection"]}),!(t=Object.keys(s.activeChannels)).length||!s.recoverStateOnReconnect){e.next=10;break}return s.logger("info","client:recoverState() - Start the querying of ".concat(t.length," channels"),{tags:["connection","client"]}),e.next=6,s.queryChannels({cid:{$in:t}},{last_message_at:-1},{limit:30});case 6:s.logger("info","client:recoverState() - Querying channels finished",{tags:["connection","client"]}),s.dispatchEvent({type:"connection.recovered"}),e.next=11;break;case 10:s.dispatchEvent({type:"connection.recovered"});case 11:s.wsPromise=Promise.resolve(),s.setUserPromise=Promise.resolve();case 13:case"end":return e.stop()}}),e)})))),_defineProperty__default.default(this,"getChannelByMembers",(function(e,t){var n=_toConsumableArray__default.default(t.members||[]).sort().join(","),r="".concat(e,":!members-").concat(n);if(!n)throw Error("Please specify atleast one member when creating unique conversation");for(var a in s.activeChannels){var i=s.activeChannels[a];if(!i.disconnected){if(a===r)return i;if(0===a.indexOf("".concat(e,":!members-")))if(Object.keys(i.state.members).sort().join(",")===n)return i}}var o=new Channel(s,e,void 0,t);return s.activeChannels[r]=o,o})),_defineProperty__default.default(this,"getChannelById",(function(e,t,n){if("string"==typeof t&&~t.indexOf(":"))throw Error("Invalid channel id ".concat(t,", can't contain the : character"));var r="".concat(e,":").concat(t);if(r in s.activeChannels&&!s.activeChannels[r].disconnected){var a=s.activeChannels[r];return Object.keys(n).length>0&&(a.data=_objectSpread(_objectSpread({},a.data),n),a._data=_objectSpread(_objectSpread({},a._data),n)),a}var i=new Channel(s,e,t,n);return s.activeChannels[i.cid]=i,i})),_defineProperty__default.default(this,"updateUsers",this.upsertUsers),_defineProperty__default.default(this,"updateUser",this.upsertUser),_defineProperty__default.default(this,"_unblockMessage",this.unblockMessage),_defineProperty__default.default(this,"markAllRead",this.markChannelsRead),_defineProperty__default.default(this,"_isUsingServerAuth",(function(){return!!s.secret})),_defineProperty__default.default(this,"_buildWSPayload",(function(e){return JSON.stringify({user_id:s.userID,user_details:s._user,device:s.options.device,client_request_id:e})})),this.key=t,this.listeners={},this.state=new ClientState,this.mutedChannels=[],this.mutedUsers=[],this.moderation=new Moderation(this),n&&isString(n)&&(this.secret=n);var i=r||(n&&!isString(n)?n:{});this.browser=void 0!==i.browser?i.browser:"undefined"!=typeof window,this.node=!this.browser,this.options=_objectSpread({timeout:3e3,withCredentials:!1,warmUp:!1,recoverStateOnReconnect:!0},i),this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new https.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.axiosInstance=axios__default.default.create(this.options),this.setBaseURL(this.options.baseURL||"https://chat.stream-io-api.com"),"undefined"!=typeof process&&"env"in process&&process.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030"),"undefined"!=typeof process&&"env"in process&&process.env.STREAM_LOCAL_TEST_HOST&&this.setBaseURL("http://"+process.env.STREAM_LOCAL_TEST_HOST),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.activeChannels={},this.configs={},this.anonymous=!1,this.persistUserOnConnectionFailure=null===(a=this.options)||void 0===a?void 0:a.persistUserOnConnectionFailure,this.tokenManager=new TokenManager(this.secret),this.consecutiveFailures=0,this.insightMetrics=new InsightMetrics,this.defaultWSTimeoutWithFallback=6e3,this.defaultWSTimeout=15e3,this.axiosInstance.defaults.paramsSerializer=axiosParamsSerializer,this.logger=isFunction(i.logger)?i.logger:function(){return null},this.recoverStateOnReconnect=this.options.recoverStateOnReconnect,this.threads=new ThreadManager({client:this})}var t,n,r,a,s,i,o,u,l,c,d,f,_,p,h,g,v,m,y,b,w,k,R,S,C,x,T,P,U,I,j,A,O,E,M,L,D,G,$,F,q,N,W,B,z,H,V,K,Q,J,Y,X,Z,ee,te,ne,re,ae,se,ie,oe,ue,le,ce,de,fe,_e,pe,he,ge,ve,me,ye,be,we,ke,Re,Se,Ce,xe,Te,Pe,Ue,Ie,je,Ae,Oe,Ee,Me,Le,De,Ge,$e,Fe,qe,Ne,We,Be,ze,He,Ve,Ke,Qe,Je,Ye,Xe,Ze,et;return _createClass__default.default(e,[{key:"devToken",value:function(e){return DevToken(e)}},{key:"getAuthType",value:function(){return this.anonymous?"anonymous":"jwt"}},{key:"setBaseURL",value:function(e){this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")}},{key:"_setUser",value:function(e){this.user=e,this.userID=e.id,this._user=_objectSpread({},e)}},{key:"updateAppSettings",value:(et=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!=(n=t.apn_config)&&n.p12_cert&&(t=_objectSpread(_objectSpread({},t),{},{apn_config:_objectSpread(_objectSpread({},n),{},{p12_cert:Buffer.from(n.p12_cert).toString("base64")})})),e.next=4,this.patch(this.baseURL+"/app",t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return et.apply(this,arguments)})},{key:"revokeTokens",value:(Ze=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.updateAppSettings({revoke_tokens_issued_before:this._normalizeDate(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ze.apply(this,arguments)})},{key:"revokeUserToken",value:(Xe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.revokeUsersToken([t],n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Xe.apply(this,arguments)})},{key:"revokeUsersToken",value:(Ye=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a,s,i;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=void 0===n?(new Date).toISOString():this._normalizeDate(n),r=[],a=_createForOfIteratorHelper(t);try{for(a.s();!(s=a.n()).done;)i=s.value,r.push({id:i,set:{revoke_tokens_issued_before:n}})}catch(e){a.e(e)}finally{a.f()}return e.next=6,this.partialUpdateUsers(r);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ye.apply(this,arguments)})},{key:"getAppSettings",value:(Je=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/app");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return Je.apply(this,arguments)})},{key:"testPushSettings",value:(Qe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/check_push",_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({user_id:t},n.messageID?{message_id:n.messageID}:{}),n.apnTemplate?{apn_template:n.apnTemplate}:{}),n.firebaseTemplate?{firebase_template:n.firebaseTemplate}:{}),n.firebaseDataTemplate?{firebase_data_template:n.firebaseDataTemplate}:{}),n.skipDevices?{skip_devices:!0}:{}),n.pushProviderName?{push_provider_name:n.pushProviderName}:{}),n.pushProviderType?{push_provider_type:n.pushProviderType}:{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return Qe.apply(this,arguments)})},{key:"testSQSSettings",value:(Ke=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sqs",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return Ke.apply(this,arguments)})},{key:"testSNSSettings",value:(Ve=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/check_sns",t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(){return Ve.apply(this,arguments)})},{key:"setGuestUser",value:(He=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.anonymous=!0,e.prev=1,e.next=4,this.post(this.baseURL+"/guest",{user:t});case 4:n=e.sent,e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(1),this.anonymous=!1,e.t0;case 11:return this.anonymous=!1,(r=n.user).created_at,r.updated_at,r.last_active,r.online,a=_objectWithoutProperties__default.default(r,_excluded),e.next=15,this.connectUser(a,n.access_token);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return He.apply(this,arguments)})},{key:"createToken",value:function(e,t,n){if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");var r={};return t&&(r.exp=t),n&&(r.iat=n),JWTUserToken(this.secret,e,r,{})}},{key:"on",value:function(e,t){var n=this,r=t?e:"all",a=t||e;return r in this.listeners||(this.listeners[r]=[]),this.logger("info","Attaching listener for ".concat(r," event"),{tags:["event","client"]}),this.listeners[r].push(a),{unsubscribe:function(){n.logger("info","Removing listener for ".concat(r," event"),{tags:["event","client"]}),n.listeners[r]=n.listeners[r].filter((function(e){return e!==a}))}}}},{key:"off",value:function(e,t){var n=t?e:"all",r=t||e;n in this.listeners||(this.listeners[n]=[]),this.logger("info","Removing listener for ".concat(n," event"),{tags:["event","client"]}),this.listeners[n]=this.listeners[n].filter((function(e){return e!==r}))}},{key:"_logApiRequest",value:function(e,t,n,r){this.logger("info","client: ".concat(e," - Request - ").concat(t),{tags:["api","api_request","client"],url:t,payload:n,config:r})}},{key:"_logApiResponse",value:function(e,t,n){this.logger("info","client:".concat(e," - Response - url: ").concat(t," > status ").concat(n.status),{tags:["api","api_response","client"],url:t,response:n})}},{key:"_logApiError",value:function(e,t,n){this.logger("error","client:".concat(e," - Error - url: ").concat(t),{tags:["api","api_response","client"],url:t,error:n})}},{key:"get",value:function(e,t){return this.doAxiosRequest("get",e,null,{params:t})}},{key:"put",value:function(e,t){return this.doAxiosRequest("put",e,t)}},{key:"post",value:function(e,t){return this.doAxiosRequest("post",e,t)}},{key:"patch",value:function(e,t){return this.doAxiosRequest("patch",e,t)}},{key:"delete",value:function(e,t){return this.doAxiosRequest("delete",e,null,{params:t})}},{key:"sendFile",value:function(e,t,n,r,a){var s=addFileToFormData(t,n,r||"multipart/form-data");return null!=a&&s.append("user",JSON.stringify(a)),this.doAxiosRequest("postForm",e,s,{headers:s.getHeaders?s.getHeaders():{},config:{timeout:0,maxContentLength:1/0,maxBodyLength:1/0}})}},{key:"errorFromResponse",value:function(e){var t;return t=new ErrorFromResponse("StreamChat error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=new Error("StreamChat error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t}},{key:"handleResponse",value:function(e){var t=e.data;if(isErrorResponse(e))throw this.errorFromResponse(e);return t}},{key:"_handleClientEvent",value:function(e){var t,n,r,a=this,s=this,i=[];(this.logger("info","client:_handleClientEvent - Received event of type { ".concat(e.type," }"),{tags:["event","client"],event:e}),"user.presence.changed"!==e.type&&"user.updated"!==e.type&&"user.deleted"!==e.type||this._handleUserEvent(e),"health.check"===e.type&&e.me&&(s.user=e.me,s.state.updateUser(e.me),s.mutedChannels=e.me.channel_mutes,s.mutedUsers=e.me.mutes),e.channel&&"notification.message_new"===e.type&&this._addChannelConfig(e.channel),"notification.channel_mutes_updated"===e.type&&null!==(t=e.me)&&void 0!==t&&t.channel_mutes&&(this.mutedChannels=e.me.channel_mutes),"notification.mutes_updated"===e.type&&null!==(n=e.me)&&void 0!==n&&n.mutes&&(this.mutedUsers=e.me.mutes),"notification.mark_read"===e.type&&0===e.unread_channels)&&Object.keys(this.activeChannels).forEach((function(e){return a.activeChannels[e].state.unreadCount=0}));"channel.deleted"!==e.type&&"notification.channel_deleted"!==e.type||!e.cid||(s.state.deleteAllChannelReference(e.cid),null===(r=this.activeChannels[e.cid])||void 0===r||r._disconnect(),i.push((function(){e.cid&&delete a.activeChannels[e.cid]})));return i}},{key:"_muteStatus",value:function(e){for(var t,n=0;n<this.mutedChannels.length;n++){var r,a=this.mutedChannels[n];if((null===(r=a.channel)||void 0===r?void 0:r.cid)===e){t={muted:!a.expires||new Date(a.expires).getTime()>(new Date).getTime(),createdAt:a.created_at?new Date(a.created_at):new Date,expiresAt:a.expires?new Date(a.expires):null};break}}return t||{muted:!1,createdAt:null,expiresAt:null}}},{key:"connect",value:(ze=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.userID&&this._user){e.next=2;break}throw Error("Call connectUser or connectAnonymousUser before starting the connection");case 2:if(this.wsBaseURL){e.next=4;break}throw Error("Websocket base url not set");case 4:if(this.clientID){e.next=6;break}throw Error("clientID is not set");case 6:if(this.wsConnection||!this.options.warmUp&&!this.options.enableInsights||this._sayHi(),this.options.wsConnection&&this.node?(this.options.wsConnection.setClient(this),this.wsConnection=this.options.wsConnection):this.wsConnection=new StableWSConnection({client:this}),e.prev=8,!this.wsFallback){e.next=13;break}return e.next=12,this.wsFallback.connect();case 12:case 15:case 28:return e.abrupt("return",e.sent);case 13:return e.next=15,this.wsConnection.connect(this.options.enableWSFallback?this.defaultWSTimeoutWithFallback:this.defaultWSTimeout);case 18:if(e.prev=18,e.t0=e.catch(8),!(this.options.enableWSFallback&&isWSFailure(e.t0)&&isOnline())){e.next=29;break}return this.logger("info","client:connect() - WS failed, fallback to longpoll",{tags:["connection","client"]}),this.dispatchEvent({type:"transport.changed",mode:"longpoll"}),this.wsConnection._destroyCurrentWSConnection(),this.wsConnection.disconnect().then(),this.wsFallback=new WSConnectionFallback({client:this}),e.next=28,this.wsFallback.connect();case 29:throw e.t0;case 30:case"end":return e.stop()}}),e,this,[[8,18]])}))),function(){return ze.apply(this,arguments)})},{key:"_sayHi",value:function(){var e=this,t=randomId(),n={headers:{"x-client-request-id":t}};this.doAxiosRequest("get",this.baseURL+"/hi",null,n).catch((function(n){e.options.enableInsights&&postInsights("http_hi_failed",{api_key:e.key,err:n,client_request_id:t})}))}},{key:"queryUsers",value:(Be=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:[],r=i.length>2&&void 0!==i[2]?i[2]:{},a={presence:!1},e.next=5,this.wsPromise;case 5:return this._hasConnectionID()||(a.presence=!1),e.next=8,this.get(this.baseURL+"/users",{payload:_objectSpread(_objectSpread({filter_conditions:t,sort:normalizeQuerySort(n)},a),r)});case 8:return s=e.sent,this.state.updateUsers(s.users),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return Be.apply(this,arguments)})},{key:"queryBannedUsers",value:(We=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=5,this.get(this.baseURL+"/query_banned_users",{payload:_objectSpread({filter_conditions:t,sort:normalizeQuerySort(n)},r)});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return We.apply(this,arguments)})},{key:"queryMessageFlags",value:(Ne=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.get(this.baseURL+"/moderation/flags/message",{payload:_objectSpread({filter_conditions:t},n)});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return Ne.apply(this,arguments)})},{key:"queryChannels",value:(qe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s,i,o,u=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:[],r=u.length>2&&void 0!==u[2]?u[2]:{},a=u.length>3&&void 0!==u[3]?u[3]:{},s={state:!0,watch:!0,presence:!1},e.next=6,this.wsPromise;case 6:return this._hasConnectionID()||(s.watch=!1),i=_objectSpread(_objectSpread({filter_conditions:t,sort:normalizeQuerySort(n)},s),r),e.next=10,this.post(this.baseURL+"/channels",i);case 10:return o=e.sent,this.dispatchEvent({type:"channels.queried",queriedChannels:{channels:o.channels,isLatestMessageSet:!0}}),e.abrupt("return",this.hydrateActiveChannels(o.channels,a,r));case 13:case"end":return e.stop()}}),e,this)}))),function(e){return qe.apply(this,arguments)})},{key:"queryReactions",value:(Fe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>2&&void 0!==i[2]?i[2]:[],a=i.length>3&&void 0!==i[3]?i[3]:{},e.next=4,this.wsPromise;case 4:return s=_objectSpread({filter:n,sort:normalizeQuerySort(r)},a),e.next=7,this.post(this.baseURL+"/messages/"+encodeURIComponent(t)+"/reactions",s);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return Fe.apply(this,arguments)})},{key:"hydrateActiveChannels",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,a=n.skipInitialization,s=n.offlineMode,i=void 0!==s&&s,o=[],u=_createForOfIteratorHelper(t);try{for(u.s();!(e=u.n()).done;){var l=e.value;this._addChannelConfig(l.channel);var c=this.channel(l.channel.type,l.channel.id);c.data=l.channel,c.offlineMode=i,c.initialized=!i;var d=void 0;if(void 0===a)d=c._initializeState(l,"latest").messageSet;else if(!a.includes(l.channel.id)){c.state.clearMessages(),d=c._initializeState(l,"latest").messageSet}d&&(d.pagination=_objectSpread(_objectSpread({},d.pagination),messageSetPagination({parentSet:d,requestedPageSize:(null==r?void 0:r.message_limit)||DEFAULT_QUERY_CHANNELS_MESSAGE_LIST_PAGE_SIZE,returnedPage:l.messages,logger:this.logger}))),o.push(c)}}catch(e){u.e(e)}finally{u.f()}return o}},{key:"search",value:($e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=s.length>2&&void 0!==s[2]?s[2]:{}).offset||!r.next){e.next=3;break}throw Error("Cannot specify offset with next");case 3:if(a=_objectSpread(_objectSpread({filter_conditions:t},r),{},{sort:r.sort?normalizeQuerySort(r.sort):void 0}),"string"!=typeof n){e.next=8;break}a.query=n,e.next=13;break;case 8:if("object"!==_typeof__default.default(n)){e.next=12;break}a.message_filter_conditions=n,e.next=13;break;case 12:throw Error("Invalid type ".concat(_typeof__default.default(n)," for query parameter"));case 13:return e.next=15,this.wsPromise;case 15:return e.next=17,this.get(this.baseURL+"/search",{payload:a});case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return $e.apply(this,arguments)})},{key:"setLocalDevice",value:function(e){var t,n,r;if(null!==(t=this.wsConnection)&&void 0!==t&&t.isConnecting&&this.wsPromise||(null!==(n=this.wsConnection)&&void 0!==n&&n.isHealthy||null!==(r=this.wsFallback)&&void 0!==r&&r.isHealthy())&&this._hasConnectionID())throw new Error("you can only set device before opening a websocket connection");this.options.device=e}},{key:"addDevice",value:(Ge=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/devices",_objectSpread(_objectSpread({id:t,push_provider:n},null!=r?{user_id:r}:{}),null!=a?{push_provider_name:a}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return Ge.apply(this,arguments)})},{key:"getDevices",value:(De=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/devices",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return De.apply(this,arguments)})},{key:"getUnreadCount",value:(Le=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/unread",t?{user_id:t}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Le.apply(this,arguments)})},{key:"getUnreadCountBatch",value:(Me=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/unread_batch",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Me.apply(this,arguments)})},{key:"removeDevice",value:(Ee=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/devices",_objectSpread({id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ee.apply(this,arguments)})},{key:"getRateLimits",value:(Oe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s,i,o;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(n=t||{}).serverSide,a=n.web,s=n.android,i=n.ios,o=n.endpoints,e.abrupt("return",this.get(this.baseURL+"/rate_limits",{server_side:r,web:a,android:s,ios:i,endpoints:o?o.join(","):void 0}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return Oe.apply(this,arguments)})},{key:"_addChannelConfig",value:function(e){var t=e.cid,n=e.config;this.configs[t]=n}},{key:"channel",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.userID&&!this._isUsingServerAuth())throw Error("Call connectUser or connectAnonymousUser before creating a channel");if(~e.indexOf(":"))throw Error("Invalid channel group ".concat(e,", can't contain the : character"));return t&&"object"===_typeof__default.default(t)?this.getChannelByMembers(e,t):!t&&"object"===_typeof__default.default(r)&&null!==(n=r.members)&&void 0!==n&&n.length?this.getChannelByMembers(e,r):t?this.getChannelById(e,t,r):new Channel(this,e,void 0,r)}},{key:"partialUpdateUser",value:(Ae=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.partialUpdateUsers([t]);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Ae.apply(this,arguments)})},{key:"upsertUsers",value:(je=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n={},r=_createForOfIteratorHelper(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=11;break}if((s=a.value).id){e.next=8;break}throw Error("User ID is required when updating a user");case 8:n[s.id]=s;case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.next=21,this.post(this.baseURL+"/users",{users:n});case 21:return e.abrupt("return",e.sent);case 22:case"end":return e.stop()}}),e,this,[[2,13,16,19]])}))),function(e){return je.apply(this,arguments)})},{key:"upsertUser",value:function(e){return this.upsertUsers([e])}},{key:"partialUpdateUsers",value:(Ie=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper(t),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}if(r.value.id){e.next=7;break}throw Error("User ID is required when updating a user");case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:return e.next=19,this.patch(this.baseURL+"/users",{users:t});case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(e){return Ie.apply(this,arguments)})},{key:"deleteUser",value:(Ue=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/users/".concat(encodeURIComponent(t)),n);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ue.apply(this,arguments)})},{key:"restoreUsers",value:(Pe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/restore",{user_ids:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return Pe.apply(this,arguments)})},{key:"reactivateUser",value:(Te=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/reactivate"),_objectSpread({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Te.apply(this,arguments)})},{key:"reactivateUsers",value:(xe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/reactivate",_objectSpread({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return xe.apply(this,arguments)})},{key:"deactivateUser",value:(Ce=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/".concat(encodeURIComponent(t),"/deactivate"),_objectSpread({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ce.apply(this,arguments)})},{key:"deactivateUsers",value:(Se=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/deactivate",_objectSpread({user_ids:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Se.apply(this,arguments)})},{key:"exportUser",value:(Re=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/".concat(encodeURIComponent(t),"/export"),_objectSpread({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Re.apply(this,arguments)})},{key:"banUser",value:(ke=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/ban",_objectSpread({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ke.apply(this,arguments)})},{key:"unbanUser",value:(we=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/moderation/ban",_objectSpread({target_user_id:t},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return we.apply(this,arguments)})},{key:"shadowBan",value:(be=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.banUser(t,_objectSpread({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return be.apply(this,arguments)})},{key:"removeShadowBan",value:(ye=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.unbanUser(t,_objectSpread({shadow:!0},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ye.apply(this,arguments)})},{key:"blockUser",value:(me=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/block",_objectSpread({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return me.apply(this,arguments)})},{key:"getBlockedUsers",value:(ve=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/users/block",_objectSpread({},t?{user_id:t}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return ve.apply(this,arguments)})},{key:"unBlockUser",value:(ge=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/users/unblock",_objectSpread({blocked_user_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return ge.apply(this,arguments)})},{key:"muteUser",value:(he=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this.post(this.baseURL+"/moderation/mute",_objectSpread(_objectSpread({target_id:t},n?{user_id:n}:{}),r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return he.apply(this,arguments)})},{key:"unmuteUser",value:(pe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/moderation/unmute",_objectSpread({target_id:t},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return pe.apply(this,arguments)})},{key:"userMuteStatus",value:function(e){if(!this.user||!this.wsPromise)throw new Error("Make sure to await connectUser() first.");for(var t=0;t<this.mutedUsers.length;t+=1)if(this.mutedUsers[t].target.id===e)return!0;return!1}},{key:"flagMessage",value:(_e=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",_objectSpread({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return _e.apply(this,arguments)})},{key:"flagUser",value:(fe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/flag",_objectSpread({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return fe.apply(this,arguments)})},{key:"unflagMessage",value:(de=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",_objectSpread({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return de.apply(this,arguments)})},{key:"unflagUser",value:(ce=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unflag",_objectSpread({target_user_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return ce.apply(this,arguments)})},{key:"getCallToken",value:(le=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/calls/".concat(encodeURIComponent(t)),_objectSpread({},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return le.apply(this,arguments)})},{key:"_queryFlags",value:(ue=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/flags",_objectSpread({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return ue.apply(this,arguments)})},{key:"_queryFlagReports",value:(oe=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=4,this.post(this.baseURL+"/moderation/reports",_objectSpread({filter_conditions:t},n));case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(){return oe.apply(this,arguments)})},{key:"_reviewFlagReport",value:(ie=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this.patch(this.baseURL+"/moderation/reports/".concat(encodeURIComponent(t)),_objectSpread({review_result:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return ie.apply(this,arguments)})},{key:"unblockMessage",value:(se=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/moderation/unblock_message",_objectSpread({target_message_id:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return se.apply(this,arguments)})},{key:"markChannelsRead",value:(ae=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,this.post(this.baseURL+"/channels/read",_objectSpread({},t));case 3:case"end":return e.stop()}}),e,this)}))),function(){return ae.apply(this,arguments)})},{key:"createCommand",value:function(e){return this.post(this.baseURL+"/commands",e)}},{key:"getCommand",value:function(e){return this.get(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"updateCommand",value:function(e,t){return this.put(this.baseURL+"/commands/".concat(encodeURIComponent(e)),t)}},{key:"deleteCommand",value:function(e){return this.delete(this.baseURL+"/commands/".concat(encodeURIComponent(e)))}},{key:"listCommands",value:function(){return this.get(this.baseURL+"/commands")}},{key:"createChannelType",value:function(e){var t=_extends__default.default({},{commands:["all"]},e);return this.post(this.baseURL+"/channeltypes",t)}},{key:"getChannelType",value:function(e){return this.get(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"updateChannelType",value:function(e,t){return this.put(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)),t)}},{key:"deleteChannelType",value:function(e){return this.delete(this.baseURL+"/channeltypes/".concat(encodeURIComponent(e)))}},{key:"listChannelTypes",value:function(){return this.get(this.baseURL+"/channeltypes")}},{key:"translateMessage",value:(re=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/translate"),{language:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return re.apply(this,arguments)})},{key:"_normalizeExpiration",value:function(e){var t=null;if("number"==typeof e){var n=new Date;n.setSeconds(n.getSeconds()+e),t=n.toISOString()}else isString(e)?t=e:e instanceof Date&&(t=e.toISOString());return t}},{key:"_validateAndGetMessageId",value:function(e,t){var n;if("string"==typeof e)n=e;else{if(!e.id)throw Error(t);n=e.id}return n}},{key:"pinMessage",value:function(e,t,n,r){var a=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(a,{set:{pinned:!0,pin_expires:this._normalizeExpiration(t),pinned_at:this._normalizeExpiration(r)}},n)}},{key:"unpinMessage",value:function(e,t){var n=this._validateAndGetMessageId(e,"Please specify the message id when calling unpinMessage");return this.partialUpdateMessage(n,{set:{pinned:!1}},t)}},{key:"updateMessage",value:(ne=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){var a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.id){e.next=2;break}throw Error("Please specify the message id when calling updateMessage");case 2:return delete(a=_extends__default.default({},t)).id,["command","created_at","html","latest_reactions","own_reactions","quoted_message","reaction_counts","reply_count","type","updated_at","user","__html"].forEach((function(e){null!=a[e]&&delete a[e]})),null!=n&&(isString(n)?a.user_id=n:a.user={id:n.id}),Array.isArray(a.mentioned_users)&&!isString(a.mentioned_users[0])&&(a.mentioned_users=a.mentioned_users.map((function(e){return e.id}))),e.next=10,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t.id)),_objectSpread({message:a},r));case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return ne.apply(this,arguments)})},{key:"partialUpdateMessage",value:(te=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r,a){var s;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateMessage");case 2:return s=r,null!=r&&isString(r)&&(s={id:r}),e.next=6,this.put(this.baseURL+"/messages/".concat(encodeURIComponent(t)),_objectSpread(_objectSpread(_objectSpread({},n),a),{},{user:s}));case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return te.apply(this,arguments)})},{key:"deleteMessage",value:(ee=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n&&(r={hard:!0}),e.next=4,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t)),r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return ee.apply(this,arguments)})},{key:"undeleteMessage",value:(Z=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/undelete"),{undeleted_by:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return Z.apply(this,arguments)})},{key:"getMessage",value:(X=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/messages/".concat(encodeURIComponent(t)),_objectSpread({},n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return X.apply(this,arguments)})},{key:"queryThreads",value:(Y=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a=this;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=_objectSpread({limit:10,participant_limit:10,reply_limit:3,watch:!0},t),e.next=3,this.post(this.baseURL+"/threads",n);case 3:return r=e.sent,e.abrupt("return",{threads:r.threads.map((function(e){return new Thread({client:a,threadData:e})})),next:r.next});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Y.apply(this,arguments)})},{key:"getThread",value:(J=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},t){e.next=3;break}throw Error("Please specify the message id when calling partialUpdateThread");case 3:return r=_objectSpread({participant_limit:100,reply_limit:3,watch:!0},n),e.next=6,this.get(this.baseURL+"/threads/".concat(encodeURIComponent(t)),r);case 6:return a=e.sent,e.abrupt("return",new Thread({client:this,threadData:a.thread}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return J.apply(this,arguments)})},{key:"partialUpdateThread",value:(Q=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw Error("Please specify the message id when calling partialUpdateThread");case 2:r=["created_at","id","last_message_at","type","updated_at","user","reply_count","participants","channel"],e.t0=_regeneratorRuntime__default.default.keys(_objectSpread(_objectSpread({},n.set),n.unset));case 4:if((e.t1=e.t0()).done){e.next=10;break}if(a=e.t1.value,!r.includes(a)){e.next=8;break}throw Error("You cannot set ".concat(a," field on Thread object. ").concat(a," is reserved for server-side use. Please omit ").concat(a," from your set object."));case 8:e.next=4;break;case 10:return e.next=12,this.patch(this.baseURL+"/threads/".concat(encodeURIComponent(t)),n);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return Q.apply(this,arguments)})},{key:"getUserAgent",value:function(){return this.userAgent||"stream-chat-javascript-client-".concat(this.node?"node":"browser","-","8.40.8")}},{key:"setUserAgent",value:function(e){this.userAgent=e}},{key:"_enrichAxiosOptions",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},n=this._getToken(),r=n?{Authorization:n}:void 0,a=null;null!==this.nextRequestAbortController&&(a=this.nextRequestAbortController.signal,this.nextRequestAbortController=null),null!==(e=t.headers)&&void 0!==e&&e["x-client-request-id"]||(t.headers=_objectSpread(_objectSpread({},t.headers),{},{"x-client-request-id":randomId()}));var s=this.options.axiosRequestConfig||{},i=s.params,o=s.headers,u=_objectWithoutProperties__default.default(s,_excluded2);return _objectSpread(_objectSpread(_objectSpread({params:_objectSpread(_objectSpread({user_id:this.userID,connection_id:this._getConnectionID(),api_key:this.key},t.params),i||{}),headers:_objectSpread(_objectSpread(_objectSpread({},r),{},{"stream-auth-type":this.getAuthType(),"X-Stream-Client":this.getUserAgent()},t.headers),o||{})},a?{signal:a}:{}),t.config),u||{})}},{key:"_getToken",value:function(){return!this.tokenManager||this.anonymous?null:this.tokenManager.getToken()}},{key:"_startCleaning",value:function(){var e=this;null==this.cleaningIntervalRef&&(this.cleaningIntervalRef=setInterval((function(){for(var t=0,n=Object.values(e.activeChannels);t<n.length;t++){n[t].clean()}}),500))}},{key:"verifyWebhook",value:function(e,t){return!!this.secret&&CheckSignature(e,this.secret,t)}},{key:"getPermission",value:function(e){return this.get("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"createPermission",value:function(e){return this.post("".concat(this.baseURL,"/permissions"),_objectSpread({},e))}},{key:"updatePermission",value:function(e,t){return this.put("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)),_objectSpread({},t))}},{key:"deletePermission",value:function(e){return this.delete("".concat(this.baseURL,"/permissions/").concat(encodeURIComponent(e)))}},{key:"listPermissions",value:function(){return this.get("".concat(this.baseURL,"/permissions"))}},{key:"createRole",value:function(e){return this.post("".concat(this.baseURL,"/roles"),{name:e})}},{key:"listRoles",value:function(){return this.get("".concat(this.baseURL,"/roles"))}},{key:"deleteRole",value:function(e){return this.delete("".concat(this.baseURL,"/roles/").concat(encodeURIComponent(e)))}},{key:"sync",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.post("".concat(this.baseURL,"/sync"),_objectSpread({channel_cids:e,last_sync_at:t},n))}},{key:"sendUserCustomEvent",value:(K=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post("".concat(this.baseURL,"/users/").concat(encodeURIComponent(t),"/event"),{event:n});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return K.apply(this,arguments)})},{key:"createBlockList",value:function(e){return this.post("".concat(this.baseURL,"/blocklists"),e)}},{key:"listBlockLists",value:function(){return this.get("".concat(this.baseURL,"/blocklists"))}},{key:"getBlockList",value:function(e){return this.get("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)))}},{key:"updateBlockList",value:function(e,t){return this.put("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)),t)}},{key:"deleteBlockList",value:function(e){return this.delete("".concat(this.baseURL,"/blocklists/").concat(encodeURIComponent(e)))}},{key:"exportChannels",value:function(e){var t=_objectSpread({channels:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return this.post("".concat(this.baseURL,"/export_channels"),t)}},{key:"exportUsers",value:function(e){return this.post("".concat(this.baseURL,"/export/users"),e)}},{key:"exportChannel",value:function(e,t){return this.exportChannels([e],t)}},{key:"getExportChannelStatus",value:function(e){return this.get("".concat(this.baseURL,"/export_channels/").concat(encodeURIComponent(e)))}},{key:"campaign",value:function(e,t){return e&&"object"===_typeof__default.default(e)?new Campaign(this,null,e):new Campaign(this,e,t)}},{key:"segment",value:function(e,t,n){return"string"==typeof t?new Segment(this,e,t,n):new Segment(this,e,null,t)}},{key:"validateServerSideAuth",value:function(){if(!this.secret)throw new Error("Campaigns is a server-side only feature. Please initialize the client with a secret to use this feature.")}},{key:"createSegment",value:(V=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){var a;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),a=_objectSpread({id:n,type:t},r),e.abrupt("return",this.post(this.baseURL+"/segments",a));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return V.apply(this,arguments)})},{key:"createUserSegment",value:(H=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("user",t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return H.apply(this,arguments)})},{key:"createChannelSegment",value:(z=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.createSegment("channel",t,n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"getSegment",value:(B=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return B.apply(this,arguments)})},{key:"updateSegment",value:(W=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/segments/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return W.apply(this,arguments)})},{key:"addSegmentTargets",value:(N=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/addtargets"),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return N.apply(this,arguments)})},{key:"querySegmentTargets",value:(q=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2&&void 0!==s[2]?s[2]:[],a=s.length>3&&void 0!==s[3]?s[3]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/targets/query"),_objectSpread({filter:n||{},sort:r||[]},a)));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"removeSegmentTargets",value:(F=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),r={target_ids:n},e.abrupt("return",this.post(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/deletetargets"),r));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return F.apply(this,arguments)})},{key:"querySegments",value:($=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/segments/query",_objectSpread({filter:t,sort:n},r)));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return $.apply(this,arguments)})},{key:"deleteSegment",value:(G=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/segments/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"segmentTargetExists",value:(D=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/segments/".concat(encodeURIComponent(t),"/target/").concat(encodeURIComponent(n))));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"createCampaign",value:(L=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns",_objectSpread({},t)));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"getCampaign",value:(M=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.get(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"startCampaign",value:(E=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/start"),{scheduled_for:null==n?void 0:n.scheduledFor,stop_at:null==n?void 0:n.stopAt}));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return E.apply(this,arguments)})},{key:"queryCampaigns",value:(O=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.next=3,this.post(this.baseURL+"/campaigns/query",_objectSpread({filter:t,sort:n},r||{}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return O.apply(this,arguments)})},{key:"updateCampaign",value:(A=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.put(this.baseURL+"/campaigns/".concat(encodeURIComponent(t)),n));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return A.apply(this,arguments)})},{key:"deleteCampaign",value:(j=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.delete(this.baseURL+"/campaigns/".concat(encodeURIComponent(t))));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"stopCampaign",value:(I=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.validateServerSideAuth(),e.abrupt("return",this.post(this.baseURL+"/campaigns/".concat(encodeURIComponent(t),"/stop")));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"enrichURL",value:(U=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get(this.baseURL+"/og",{url:t}));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)})},{key:"getTask",value:(P=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.get("".concat(this.baseURL,"/tasks/").concat(encodeURIComponent(t))));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return P.apply(this,arguments)})},{key:"deleteChannels",value:(T=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.next=3,this.post(this.baseURL+"/channels/delete",_objectSpread({cids:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"deleteUsers",value:(x=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=r.length>1&&void 0!==r[1]?r[1]:{}).user||["soft","hard","pruning"].includes(n.user)){e.next=3;break}throw new Error("Invalid delete user options. user must be one of [soft hard pruning]");case 3:if(void 0===n.conversations||["soft","hard"].includes(n.conversations)){e.next=5;break}throw new Error("Invalid delete user options. conversations must be one of [soft hard]");case 5:if(void 0===n.messages||["soft","hard","pruning"].includes(n.messages)){e.next=7;break}throw new Error("Invalid delete user options. messages must be one of [soft hard pruning]");case 7:return e.next=9,this.post(this.baseURL+"/users/delete",_objectSpread({user_ids:t},n));case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return x.apply(this,arguments)})},{key:"_createImportURL",value:(C=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/import_urls",{filename:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return C.apply(this,arguments)})},{key:"_createImport",value:(S=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{mode:"upsert"},e.next=3,this.post(this.baseURL+"/imports",_objectSpread({path:t},n));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"_getImport",value:(R=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports/".concat(encodeURIComponent(t)));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)})},{key:"_listImports",value:(k=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/imports",t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"upsertPushProvider",value:(w=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/push_providers",{push_provider:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return w.apply(this,arguments)})},{key:"deletePushProvider",value:(b=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.type,r=t.name,e.next=3,this.delete(this.baseURL+"/push_providers/".concat(encodeURIComponent(n),"/").concat(encodeURIComponent(r)));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"listPushProviders",value:(y=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/push_providers");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"createAbortControllerForNextRequest",value:function(){return this.nextRequestAbortController=new AbortController}},{key:"commitMessage",value:(m=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/commit"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"createPoll",value:(v=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls",_objectSpread(_objectSpread({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"getPoll",value:(g=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t)),n?{user_id:n}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return g.apply(this,arguments)})},{key:"updatePoll",value:(h=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls",_objectSpread(_objectSpread({},t),n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"partialUpdatePoll",value:(p=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.patch(this.baseURL+"/polls/".concat(encodeURIComponent(t)),_objectSpread(_objectSpread({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"deletePoll",value:(_=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t)),_objectSpread({},n?{user_id:n}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return _.apply(this,arguments)})},{key:"closePoll",value:(f=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.partialUpdatePoll(t,_objectSpread({set:{is_closed:!0}},n?{user_id:n}:{})));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return f.apply(this,arguments)})},{key:"createPollOption",value:(d=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),_objectSpread(_objectSpread({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"getPollOption",value:(c=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"updatePollOption",value:(l=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.put(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options"),_objectSpread(_objectSpread({},n),r?{user_id:r}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return l.apply(this,arguments)})},{key:"deletePollOption",value:(u=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/options/").concat(encodeURIComponent(n)),r?{user_id:r}:{});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return u.apply(this,arguments)})},{key:"castPollVote",value:(o=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.post(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote"),_objectSpread({vote:r},a?{user_id:a}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"addPollAnswer",value:(i=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.castPollVote(t,n,{answer_text:r},a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"removePollVote",value:(s=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n,r,a){return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.delete(this.baseURL+"/messages/".concat(encodeURIComponent(t),"/polls/").concat(encodeURIComponent(n),"/vote/").concat(encodeURIComponent(r)),_objectSpread({},a?{user_id:a}:{}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return s.apply(this,arguments)})},{key:"queryPolls",value:(a=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a,s,i=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:{},n=i.length>1&&void 0!==i[1]?i[1]:[],r=i.length>2&&void 0!==i[2]?i[2]:{},s=(a=i.length>3?i[3]:void 0)?"?user_id=".concat(a):"",e.next=7,this.post(this.baseURL+"/polls/query".concat(s),_objectSpread({filter:t,sort:normalizeQuerySort(n)},r));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"queryPollVotes",value:(r=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t){var n,r,a,s,i,o=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:[],a=o.length>3&&void 0!==o[3]?o[3]:{},i=(s=o.length>4?o[4]:void 0)?"?user_id=".concat(s):"",e.next=7,this.post(this.baseURL+"/polls/".concat(encodeURIComponent(t),"/votes").concat(i),_objectSpread({filter:n,sort:normalizeQuerySort(r)},a));case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"queryMessageHistory",value:(n=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(){var t,n,r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=5,this.post(this.baseURL+"/messages/history",_objectSpread({filter:t,sort:normalizeQuerySort(n)},r));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"updateFlags",value:(t=_asyncToGenerator__default.default(_regeneratorRuntime__default.default.mark((function e(t,n){var r,a=arguments;return _regeneratorRuntime__default.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.next=3,this.post(this.baseURL+"/automod/v1/moderation/update_flags",_objectSpread({message_ids:t,reviewed_by:n},r));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"getInstance",value:function(t,n,r){return e._instance||(e._instance="string"==typeof n?new e(t,n,r):new e(t,n)),e._instance}}]),e}();_defineProperty__default.default(StreamChat,"_instance",void 0);var EVENT_MAP={"channel.created":!0,"channel.deleted":!0,"channel.hidden":!0,"channel.kicked":!0,"channel.muted":!0,"channel.truncated":!0,"channel.unmuted":!0,"channel.updated":!0,"channel.visible":!0,"health.check":!0,"member.added":!0,"member.removed":!0,"member.updated":!0,"message.deleted":!0,"message.new":!0,"message.read":!0,"message.updated":!0,"message.undeleted":!0,"notification.added_to_channel":!0,"notification.channel_deleted":!0,"notification.channel_mutes_updated":!0,"notification.channel_truncated":!0,"notification.invite_accepted":!0,"notification.invite_rejected":!0,"notification.invited":!0,"notification.mark_read":!0,"notification.mark_unread":!0,"notification.message_new":!0,"notification.mutes_updated":!0,"notification.removed_from_channel":!0,"notification.thread_message_new":!0,"poll.closed":!0,"poll.updated":!0,"poll.vote_casted":!0,"poll.vote_changed":!0,"poll.vote_removed":!0,"reaction.deleted":!0,"reaction.new":!0,"reaction.updated":!0,"typing.start":!0,"typing.stop":!0,"user.banned":!0,"user.deleted":!0,"user.presence.changed":!0,"user.unbanned":!0,"user.unread_message_reminder":!0,"user.updated":!0,"user.watching.start":!0,"user.watching.stop":!0,"channels.queried":!0,"connection.changed":!0,"connection.recovered":!0,"transport.changed":!0,"capabilities.changed":!0},Allow="Allow",Deny="Deny",AnyResource=["*"],AnyRole=["*"],MaxPriority=999,MinPriority=1,Permission=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:AnyResource,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:AnyRole,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Allow;_classCallCheck__default.default(this,e),_defineProperty__default.default(this,"name",void 0),_defineProperty__default.default(this,"action",void 0),_defineProperty__default.default(this,"owner",void 0),_defineProperty__default.default(this,"priority",void 0),_defineProperty__default.default(this,"resources",void 0),_defineProperty__default.default(this,"roles",void 0),this.name=t,this.action=i,this.owner=s,this.priority=n,this.resources=r,this.roles=a},AllowAll=new Permission("Allow all",MaxPriority,AnyResource,AnyRole,!1,Allow),DenyAll=new Permission("Deny all",MinPriority,AnyResource,AnyRole,!1,Deny),BuiltinRoles={Admin:"admin",Anonymous:"anonymous",ChannelMember:"channel_member",ChannelModerator:"channel_moderator",Guest:"guest",User:"user"},BuiltinPermissions={AddLinks:"Add Links",BanUser:"Ban User",CreateChannel:"Create Channel",CreateMessage:"Create Message",CreateReaction:"Create Reaction",DeleteAnyAttachment:"Delete Any Attachment",DeleteAnyChannel:"Delete Any Channel",DeleteAnyMessage:"Delete Any Message",DeleteAnyReaction:"Delete Any Reaction",DeleteOwnAttachment:"Delete Own Attachment",DeleteOwnChannel:"Delete Own Channel",DeleteOwnMessage:"Delete Own Message",DeleteOwnReaction:"Delete Own Reaction",ReadAnyChannel:"Read Any Channel",ReadOwnChannel:"Read Own Channel",RunMessageAction:"Run Message Action",UpdateAnyChannel:"Update Any Channel",UpdateAnyMessage:"Update Any Message",UpdateMembersAnyChannel:"Update Members Any Channel",UpdateMembersOwnChannel:"Update Members Own Channel",UpdateOwnChannel:"Update Own Channel",UpdateOwnMessage:"Update Own Message",UploadAttachment:"Upload Attachment",UseFrozenChannel:"Send messages and reactions to frozen channels"};exports.Allow=Allow,exports.AllowAll=AllowAll,exports.AnyResource=AnyResource,exports.AnyRole=AnyRole,exports.BuiltinPermissions=BuiltinPermissions,exports.BuiltinRoles=BuiltinRoles,exports.Campaign=Campaign,exports.Channel=Channel,exports.ChannelState=ChannelState,exports.CheckSignature=CheckSignature,exports.ClientState=ClientState,exports.Deny=Deny,exports.DenyAll=DenyAll,exports.DevToken=DevToken,exports.EVENT_MAP=EVENT_MAP,exports.ErrorFromResponse=ErrorFromResponse,exports.InsightMetrics=InsightMetrics,exports.JWTServerToken=JWTServerToken,exports.JWTUserToken=JWTUserToken,exports.MODERATION_ENTITY_TYPES=MODERATION_ENTITY_TYPES,exports.MaxPriority=MaxPriority,exports.MinPriority=MinPriority,exports.Moderation=Moderation,exports.Permission=Permission,exports.Segment=Segment,exports.StableWSConnection=StableWSConnection,exports.StateStore=StateStore,exports.StreamChat=StreamChat,exports.Thread=Thread,exports.ThreadManager=ThreadManager,exports.TokenManager=TokenManager,exports.UserFromToken=UserFromToken,exports.buildWsFatalInsight=buildWsFatalInsight,exports.buildWsSuccessAfterFailureInsight=buildWsSuccessAfterFailureInsight,exports.chatCodes=chatCodes,exports.decodeBase64=decodeBase64,exports.encodeBase64=encodeBase64,exports.formatMessage=formatMessage,exports.isOwnUser=isOwnUser,exports.logChatPromiseExecution=logChatPromiseExecution,exports.postInsights=postInsights;
//# sourceMappingURL=/sm/7d99b3a9768eb3b66e5b93c6474e5e326b6d0d2571de1d6fdfe2c8a4293854f9.map